var $jscomp={scope:{},findInternal:function(b,f,e){b instanceof String&&(b=String(b));for(var d=b.length,k=0;k<d;k++){var m=b[k];if(f.call(e,m,k,b))return{i:k,v:m}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[f]=e.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,f,e,d){if(f){e=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var k=b[d];k in e||(e[k]={});e=e[k]}b=b[b.length-1];d=e[b];f=f(d);f!=d&&null!=f&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,e){return $jscomp.findInternal(this,b,e).v}},"es6-impl","es3");
(function(b,f){"function"!==typeof define||!define.amd||"undefined"!=typeof nonUseAmd&&nonUseAmd?f():"undefined"!=typeof HTMLDev&&HTMLDev?define(["./signature"],f):define(["./signature.min"],f)})(window,function(b){function f(a){return Math.sqrt(a.x*a.x+a.y*a.y)}var e=window.kinggrid,d=window.Signature,k=window.jQuery;"use strict";var m=function(a,c){this.preV={x:null,y:null};this.pinchStartLen=null;this.scale=1;this.isDoubleTap=!1;this.rotate=c.rotate||function(){};this.pointStart=c.pointStart||
function(){};this.multipointStart=c.multipointStart||function(){};this.multipointEnd=c.multipointEnd||function(){};this.pinch=c.pinch||function(){};this.swipe=c.swipe||function(){};this.tap=c.tap||function(){};this.doubleTap=c.doubleTap||function(){};this.longTap=c.longTap||function(){};this.singleTap=c.singleTap||function(){};this.pressMove=c.pressMove||function(){};this.x1=this.x2=this.y1=this.y2=this.swipeTimeout=this.longTapTimeout=this.touchTimeout=this.tapTimeout=this.now=this.last=this.delta=
null;this.preTapPosition={x:null,y:null};a.addEventListener("touchstart",this.start.bind(this),!1);a.addEventListener("touchmove",this.move.bind(this),!1);a.addEventListener("touchend",this.end.bind(this),!1);a.addEventListener("touchcancel",this.cancel.bind(this),!1)};m.prototype={start:function(a){if(a.touches){this.now=Date.now();this.x1=a.touches[0].pageX;this.y1=a.touches[0].pageY;this.delta=this.now-(this.last||this.now);this.pointStart(a);null!==this.preTapPosition.x&&(this.isDoubleTap=0<this.delta&&
250>=this.delta&&30>Math.abs(this.preTapPosition.x-this.x1)&&30>Math.abs(this.preTapPosition.y-this.y1));this.preTapPosition.x=this.x1;this.preTapPosition.y=this.y1;this.last=this.now;var c=this.preV;if(1<a.touches.length){var g=a.touches[1].pageY-this.y1;c.x=a.touches[1].pageX-this.x1;c.y=g;this.pinchStartLen=f(c);this.multipointStart(a)}this.longTapTimeout=setTimeout(function(){this.longTap(a)}.bind(this),750)}},move:function(a){if(a.touches){var c=this.preV,g=a.touches.length,n=a.touches[0].pageX,
b=a.touches[0].pageY;this.isDoubleTap=!1;if(1<g){g={x:a.touches[1].pageX-n,y:a.touches[1].pageY-b};if(null!==c.x){0<this.pinchStartLen&&(a.scale=f(g)/this.pinchStartLen,this.pinch(a));var d;d=f(g)*f(c);0===d?d=0:(d=(g.x*c.x+g.y*c.y)/d,1<d&&(d=1),d=Math.acos(d));0<g.x*c.y-c.x*g.y&&(d*=-1);a.angle=180*d/Math.PI;this.rotate(a)}c.x=g.x;c.y=g.y}else null!==this.x2&&(a.deltaX=n-this.x2,a.deltaY=b-this.y2,this.pressMove(a));this._cancelLongTap();this.x2=n;this.y2=b;a.preventDefault()}},end:function(a){if(a.changedTouches){this._cancelLongTap();
var c=this;2>a.touches.length&&this.multipointEnd(a);this.x2&&30<Math.abs(this.x1-this.x2)||this.y2&&30<Math.abs(this.preV.y-this.y2)?(a.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),this.swipeTimeout=setTimeout(function(){c.swipe(a)},0)):this.tapTimeout=setTimeout(function(){c.tap(a);c.isDoubleTap?(c.doubleTap(a),clearTimeout(c.touchTimeout),c.isDoubleTap=!1):c.touchTimeout=setTimeout(function(){c.singleTap(a)},250)},0);this.preV.x=0;this.preV.y=0;this.scale=1;this.x1=this.x2=this.y1=
this.y2=this.pinchStartLen=null}},cancel:function(){clearTimeout(this.touchTimeout);clearInterval(this.tapTimeout);clearInterval(this.longTapTimeout);clearInterval(this.swipeTimeout)},_cancelLongTap:function(){clearTimeout(this.longTapTimeout)},_swipeDirection:function(a,c,g,b){return Math.abs(a-c)>=Math.abs(g-b)?0<a-c?"Left":"Right":0<g-b?"Up":"Down"}};var l=e.Utils;l.extend(d.options.template,{infoBtl:'<div class="kg-dialog kg-dialog-info" id="kg-info"><%var modified = this.modified;%><%var canSign = this.signatureData.signMeta|| this.canSign(); %><div class="kg-content"><div class="kg-tab"><ul class="kg-nav clearfix"><li class=" <% modified?"":"active"%> "><a href="#" kg-target="signatureinfo">\u7b7e\u7ae0\u4fe1\u606f</a></li><%if(this.icon_sign == null || this.icon_sign == true){%><%if(canSign){%><li class="" ><a href="#" kg-target="certinfo">\u8bc1\u4e66\u4fe1\u606f</a></li><%}%><%}%></ul><div class="kg-tab-content"><div class="kg-tab-pane <% modified?"":"active"%> signatureinfo"><% var SDATA = this.signatureData; %><% var modifiedItems = this.modifiedItems; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u68c0\u6d4b\u7ed3\u679c\uff1a</label><span class="kg-value"><%modified?"\u4fdd\u62a4\u6570\u636e\u88ab\u7be1\u6539\uff01":"\u4fdd\u62a4\u6570\u636e\u6b63\u5e38\uff01"%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e94\u7528\u7a0b\u5e8f\uff1a</label><span class="kg-value"><%SDATA.appname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6388\u6743\u5355\u4f4d\uff1a</label><span class="kg-value"><%SDATA.orgname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7528\u6237\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.username%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5bc6\u94a5\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.keysn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u540d\u79f0\uff1a</label><span class="kg-value"><%SDATA.seal.signname%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u5e8f\u5217\uff1a</label><span class="kg-value"><%SDATA.seal.signsn%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u7ae0\u65e5\u671f\uff1a</label><span class="kg-value"><%SDATA.timestamp.signtime%></span></div></div><%if(this.icon_remove == null || this.icon_remove == true){%><div><button type="button" id="revoke_<%this.signatureid%>" class="kg-button ">\u64a4\u9500\u7b7e\u7ae0</button></div><%}%></div><%if(canSign){%><div class="kg-tab-pane certinfo"><%var noCertInfo = !this.signatureData.signMeta; %><%if(!noCertInfo){%><%var certinfo = this.signatureData.signMeta.certinfo; %><div class="kg-meta"><div class="clearfix kg-item "><label class="kg-label">\u7248\u672c\uff1a</label><span class="kg-value">V<%certinfo.version%></span></div><div class="clearfix kg-item "><label class="kg-label">\u5e8f\u53f7\uff1a</label><span class="kg-value"><%certinfo.serialNumber%></span></div><div class="clearfix kg-item "><label class="kg-label">\u7b7e\u540d\u7b97\u6cd5\uff1a</label><span class="kg-value"><%certinfo.algName%></span></div><div class="clearfix kg-item "><label class="kg-label">\u9881\u53d1\u8005\uff1a</label><span class="kg-value"><%certinfo.issuerDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u4f7f\u7528\u8005\uff1a</label><span class="kg-value"><%certinfo.subjectDN%></span></div><div class="clearfix kg-item "><label class="kg-label">\u6709\u6548\u671f\u4ece\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notBefore) , "yyyy-MM-dd hh:mm:ss")%></span></div><div class="clearfix kg-item "><label class="kg-label">\u81f3\uff1a</label><span class="kg-value"><%kinggrid.Utils.formatDate(new Date(certinfo.notAfter) , "yyyy-MM-dd hh:mm:ss")%></span></div></div><%}else{%><div class="kg-meta"><div class="clearfix kg-item kg-visble "><label class="kg-label"></label><span class="kg-value">----------------------------------------------------------------------------------------------------------------------</span></div><div class="clearfix kg-item kg-nosign"><label class="kg-label">\u63d0\u793a\u4fe1\u606f\uff1a</label><span class="kg-value">\u5f53\u524d\u6587\u6863\u672a\u505a\u6570\u5b57\u7b7e\u540d</span></div><div class="clearfix kg-item kg-visble"><label class="kg-label"></label><span class="kg-value">--------------------------------------------------------------------</span></div></div><%}%><%if(noCertInfo){%><div><button type="button" id="sign_<%this.signatureid%>" class="kg-button">\u6570\u5b57\u7b7e\u540d</button></div><%}else{%><div><button type="button" id="verifysign_<%this.signatureid%>" class="kg-button">\u7b7e\u540d\u9a8c\u8bc1</button></div><%}%></div><%}%></div></div></div></div>',
handwritedlg:'<div class="kg-dialog kg-dialog-info" id="kg-handwrite">\u540d\u79f0:<input type="text" value="\u624b\u5199\u7b7e\u540d" id="nameid" />&nbsp;&nbsp;&nbsp;\u989c\u8272:<select id="hw_color"><option value="black">\u9ed1</option><option value="red">\u7ea2</option><option value="blue">\u84dd</option><option value="green">\u7eff</option></select>&nbsp;&nbsp;&nbsp;\u7b14\u5bbd:<select id="hw_width"><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option></select><canvas id="canvasId" width=80% height=300px></canvas><br /><div id="div-judge" class="kg-tab-content" align="center"><button type="button" id="clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="okid" class="kg-button">\u7b7e\u540d</button></div></div>',
barcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-barcode"><label class="kg-label">\u4e8c\u7ef4\u7801\u5185\u5bb9\uff1a</label><textarea id="bcId" align="center"></textarea><br /><div id="output"><br /></div><div id="div-judge" class="kg-tab-content"><button type="button" id="bc_clearid" class="kg-button">\u6e05\u9664</button><button type="button" id="bc_okid" class="kg-button">\u786e\u5b9a</button></div></div>',scanbarcodedlg:'<div class="kg-dialog kg-dialog-info" id="kg-scanBC"><div id="contentHolder" style="width:320px;height:320px; background:red;"><video id="html5_qrcode_video" height="320px" width="320px" autoplay></video><canvas id="qr-canvas" width="320px" height="320px" style="display:none;"></canvas> <br/> </div></div>'});
d._create.prototype.onshowSealsDialog=function(a){var c=this;a.find(".arrow").hide();a=a.find("#kg-switcher");c.switcher.animate=!1;new m(a[0],{swipe:function(a){c.switcher["Left"===a.direction?"swipePrev":"swipeNext"]()},tap:function(){c.switcher.swipeNext()}})};d.prototype.onhandleImg=function(a){var c=this,g=function(a){c.verify();c.signatureInfo()},b=function(){if(void 0!==d.options.extra){var c=a.attributes.signatureid.nodeValue;if(c&&(c=d.options.extra[c],null!=c))return c.icon_move()}}(),b=
void 0==b?!0:b;c.canMove(a)&&b?l.addEvent(a,"mousedown touchstart",function(b){b.originalEvent=b;c.runMove(b,a,function(a){a||g()});b.preventDefault();b.stopPropagation()}):d.options.verifyResType?l.addEvent(a,d.options.verifyResType,g):l.addEvent(a,"click",g)};d.prototype.signatureInfo=function(){var a=this;return a.showDialog("infoBtl",{title:!1,target:a,onShow:function(){var c=this,b=c.find(".kg-tab");c.tab=l.tab(b);if(b=c.find("#verifysign_"+a.signatureid)[0])b.onclick=function(){a.verifySignData(function(c){c.result?
d.alert(e.msg("normal_signdata","KG_MSG")):c.errcode?a.error(c):d.alert(e.msg("modify_signdata","KG_MSG"))})};if(b=c.find("#sign_"+a.signatureid)[0])b.onclick=function(){a.signSignature(function(a){a.result&&(d.alert(e.msg("success_signdata","KG_MSG")),c.remove())})};if(null==a.icon_remove||1==a.icon_remove)c.find("#revoke_"+a.signatureid)[0].onclick=function(){a.revokeSignature(function(a){a.result&&c.remove()})}}})};d.prototype.handWriteDlg=function(a,c){if(a.width&&a.height){var b=d.options.template.handwritedlg,
e=b.substring(0,b.indexOf("width=")+6),f=b.substring(b.indexOf("px "),b.length),e=e+a.width,e=e+f,b=e.substring(0,e.indexOf("height=")+7),f=e.substring(e.indexOf("px>"),e.length),b=b+a.height;d.options.template.handwritedlg=b+f}var k=this.showDialog("handwritedlg",a),b=document.getElementById("canvasId");b.width=document.body.offsetWidth*0.9; a.penColor=document.getElementById("hw_color").value;a.minWidth=.5;a.maxWidth=4.5;var h=new SignaturePad(b,a),p=document.getElementById("hw_color");p.onchange=function(){h.penColor=p.value};var l=
document.getElementById("hw_width");l.onchange=function(){switch(l.value){case "1":h.minWidth=.5;h.maxWidth=2.5;break;case "2":h.minWidth=.5;h.maxWidth=4.5;break;case "3":h.minWidth=1;h.maxWidth=6;break;case "4":h.minWidth=1;h.maxWidth=8;break;case "5":h.minWidth=2.5;h.maxWidth=10;break;case "6":h.minWidth=3;h.maxWidth=12;break;default:h.minWidth=.5,h.maxWidth=2.5}};b=document.getElementById("clearid");e=document.getElementById("okid");b&&(b.onclick=function(){h.clear()});e&&(e.onclick=function(){k.close();
var b=h.toDataURL().replace(/^data:image\/\w+;base64,/,"");b&&(b={height:a.image_height||"3.00",width:a.image_width||"7.00",imageData:b,name:document.getElementById("nameid").value},c(b),k.remove())})};d.prototype.barCodeDlg=function(a,b){var c=this.showDialog("barcodedlg",{title:"\u4e8c\u7ef4\u7801",target:this,onCancel:!1}),d=document.getElementById("bc_clearid"),e=document.getElementById("bc_okid"),f=document.getElementById("bcId");d&&(d.onclick=function(){f.value=""});e&&(e.onclick=function(){c.close();
var d=k("#output").qrcode(f.value);b({height:a.image_height||"5",width:a.image_width||"5",imageData:d,name:"\u4e8c\u7ef4\u7801"})})};d.prototype.scanBCDlg=function(a,b){var c={title:e.msg("scanBCSignature","KG_TITLE"),target:this,onCancel:!1},d=this.showDialog("scanbarcodedlg",c);try{var f=document.getElementById("qr-canvas").getContext("2d"),l=document.getElementById("html5_qrcode_video"),c={video:!0,audio:!1};window.navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||
navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL||window.oURL;window.navigator.getUserMedia&&window.navigator.getUserMedia(c,function(a){l.src=window.URL.createObjectURL(a);l.play()},function(a){alert("\u51fa\u9519\u4fe1\u606f: "+a.name)});var h=setInterval(function(){if(f){f.drawImage(l,0,0,640,480);var c=f.getImageData(0,0,640,480);if(c=jsQR.decodeQRFromImage(c.data,c.width,c.height))d.close(),window.clearInterval(h),a.content=c,c={height:a.image_height||
"5",width:a.image_width||"5",imageData:k("#output").qrcode(c),name:"\u4e8c\u7ef4\u7801"},b(c)}},2E3)}catch(p){printHtml("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301HTML5 CANVAS")}};b=kingPlus();l.extend(b.alertConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});l.extend(b.loadingConfig,{cancelDisplay:!0,quickClose:!1,backdropOpacity:.1});l.extend(b.dialogConfig,{cancelDisplay:!1,quickClose:!0});return d});
// V1.0.0.348    
//# sourceMappingURL=c:/signature.pc.min.map
