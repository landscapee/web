var $jscomp = {
    scope: {},
    findInternal: function (h, n, r) {
        h instanceof String && (h = String(h));
        for (var q = h.length, e = 0; e < q; e++) {
            var m = h[e];
            if (n.call(r, m, e, h)) return {
                i: e,
                v: m
            }
        }
        return {
            i: -1,
            v: void 0
        }
    }
};
$jscomp.defineProperty = "function" == typeof Object.defineProperties ? Object.defineProperty : function (h, n, r) {
    if (r.get || r.set) throw new TypeError("ES3 does not support getters and setters.");
    h != Array.prototype && h != Object.prototype && (h[n] = r.value)
};
$jscomp.getGlobal = function (h) {
    return "undefined" != typeof window && window === h ? h : "undefined" != typeof global ? global : h
};
$jscomp.global = $jscomp.getGlobal(this);
$jscomp.polyfill = function (h, n, r, q) {
    if (n) {
        r = $jscomp.global;
        h = h.split(".");
        for (q = 0; q < h.length - 1; q++) {
            var e = h[q];
            e in r || (r[e] = {});
            r = r[e]
        }
        h = h[h.length - 1];
        q = r[h];
        n = n(q);
        n != q && null != n && $jscomp.defineProperty(r, h, {
            configurable: !0,
            writable: !0,
            value: n
        })
    }
};
$jscomp.polyfill("Array.prototype.find", function (h) {
    return h ? h : function (h, r) {
        return $jscomp.findInternal(this, h, r).v
    }
}, "es6-impl", "es3");
var CryptoJS = CryptoJS ||
function (h, n) {
    var r = {},
        q = r.lib = {},
        e = q.Base = function () {
            function t() {}
            return {
                extend: function (m) {
                    t.prototype = this;
                    var e = new t;
                    m && e.mixIn(m);
                    e.hasOwnProperty("init") || (e.init = function () {
                        e.$super.init.apply(this, arguments)
                    });
                    e.init.prototype = e;
                    e.$super = this;
                    return e
                },
                create: function () {
                    var e = this.extend();
                    e.init.apply(e, arguments);
                    return e
                },
                init: function () {},
                mixIn: function (e) {
                    for (var m in e) e.hasOwnProperty(m) && (this[m] = e[m]);
                    e.hasOwnProperty("toString") && (this.toString = e.toString)
                },
                clone: function () {
                    return this.init.prototype.extend(this)
                }
            }
        }(),
        m = q.WordArray = e.extend({
            init: function (e, m) {
                e = this.words = e || [];
                this.sigBytes = m != n ? m : 4 * e.length
            },
            toString: function (e) {
                return (e || A).stringify(this)
            },
            concat: function (e) {
                var m = this.words,
                    g = e.words,
                    t = this.sigBytes;
                e = e.sigBytes;
                this.clamp();
                if (t % 4) for (var h = 0; h < e; h++) m[t + h >>> 2] |= (g[h >>> 2] >>> 24 - h % 4 * 8 & 255) << 24 - (t + h) % 4 * 8;
                else if (65535 < g.length) for (h = 0; h < e; h += 4) m[t + h >>> 2] = g[h >>> 2];
                else m.push.apply(m, g);
                this.sigBytes += e;
                return this
            },
            clamp: function () {
                var e =
                this.words,
                    m = this.sigBytes;
                e[m >>> 2] &= 4294967295 << 32 - m % 4 * 8;
                e.length = h.ceil(m / 4)
            },
            clone: function () {
                var m = e.clone.call(this);
                m.words = this.words.slice(0);
                return m
            },
            random: function (e) {
                for (var g = [], t = 0; t < e; t += 4) g.push(4294967296 * h.random() | 0);
                return new m.init(g, e)
            }
        }),
        v = r.enc = {},
        A = v.Hex = {
            stringify: function (e) {
                var m = e.words;
                e = e.sigBytes;
                for (var g = [], h = 0; h < e; h++) {
                    var t = m[h >>> 2] >>> 24 - h % 4 * 8 & 255;
                    g.push((t >>> 4).toString(16));
                    g.push((t & 15).toString(16))
                }
                return g.join("")
            },
            parse: function (e) {
                for (var g = e.length, h = [], t = 0; t < g; t += 2) h[t >>> 3] |= parseInt(e.substr(t, 2), 16) << 24 - t % 8 * 4;
                return new m.init(h, g / 2)
            }
        },
        F = v.Latin1 = {
            stringify: function (e) {
                var m = e.words;
                e = e.sigBytes;
                for (var g = [], h = 0; h < e; h++) g.push(String.fromCharCode(m[h >>> 2] >>> 24 - h % 4 * 8 & 255));
                return g.join("")
            },
            parse: function (e) {
                for (var g = e.length, h = [], t = 0; t < g; t++) h[t >>> 2] |= (e.charCodeAt(t) & 255) << 24 - t % 4 * 8;
                return new m.init(h, g)
            }
        },
        g = v.Utf8 = {
            stringify: function (e) {
                try {
                    return decodeURIComponent(escape(F.stringify(e)))
                } catch (w) {
                    throw Error("Malformed UTF-8 data");
                }
            },
            parse: function (e) {
                return F.parse(unescape(encodeURIComponent(e)))
            }
        },
        D = q.BufferedBlockAlgorithm = e.extend({
            reset: function () {
                this._data = new m.init;
                this._nDataBytes = 0
            },
            _append: function (e) {
                "string" == typeof e && (e = g.parse(e));
                this._data.concat(e);
                this._nDataBytes += e.sigBytes
            },
            _process: function (e) {
                var g = this._data,
                    t = g.words,
                    n = g.sigBytes,
                    q = this.blockSize,
                    A = n / (4 * q),
                    A = e ? h.ceil(A) : h.max((A | 0) - this._minBufferSize, 0);
                e = A * q;
                n = h.min(4 * e, n);
                if (e) {
                        for (var r = 0; r < e; r += q) this._doProcessBlock(t, r);
                        r = t.splice(0, e);
                        g.sigBytes -= n
                    }
                return new m.init(r, n)
            },
            clone: function () {
                var m = e.clone.call(this);
                m._data = this._data.clone();
                return m
            },
            _minBufferSize: 0
        });
    q.Hasher = D.extend({
            cfg: e.extend(),
            init: function (e) {
                this.cfg = this.cfg.extend(e);
                this.reset()
            },
            reset: function () {
                D.reset.call(this);
                this._doReset()
            },
            update: function (e) {
                this._append(e);
                this._process();
                return this
            },
            finalize: function (e) {
                e && this._append(e);
                return this._doFinalize()
            },
            blockSize: 16,
            _createHelper: function (e) {
                return function (m, g) {
                    return (new e.init(g)).finalize(m)
                }
            },
            _createHmacHelper: function (e) {
                return function (m, g) {
                    return (new B.HMAC.init(e, g)).finalize(m)
                }
            }
        });
    var B = r.algo = {};
    return r
}(Math);
(function () {
    var h = CryptoJS,
        n = h.lib,
        r = n.WordArray,
        q = n.Hasher,
        e = [],
        n = h.algo.SHA1 = q.extend({
            _doReset: function () {
                this._hash = new r.init([1732584193, 4023233417, 2562383102, 271733878, 3285377520])
            },
            _doProcessBlock: function (m, h) {
                for (var n = this._hash.words, r = n[0], g = n[1], q = n[2], v = n[3], t = n[4], w = 0; 80 > w; w++) {
                    if (16 > w) e[w] = m[h + w] | 0;
                    else {
                        var x = e[w - 3] ^ e[w - 8] ^ e[w - 14] ^ e[w - 16];
                        e[w] = x << 1 | x >>> 31
                    }
                    x = (r << 5 | r >>> 27) + t + e[w];
                    x = 20 > w ? x + ((g & q | ~g & v) + 1518500249) : 40 > w ? x + ((g ^ q ^ v) + 1859775393) : 60 > w ? x + ((g & q | g & v | q & v) - 1894007588) : x + ((g ^ q ^ v) - 899497514);
                    t = v;
                    v = q;
                    q = g << 30 | g >>> 2;
                    g = r;
                    r = x
                }
                n[0] = n[0] + r | 0;
                n[1] = n[1] + g | 0;
                n[2] = n[2] + q | 0;
                n[3] = n[3] + v | 0;
                n[4] = n[4] + t | 0
            },
            _doFinalize: function () {
                var e = this._data,
                    h = e.words,
                    n = 8 * this._nDataBytes,
                    q = 8 * e.sigBytes;
                h[q >>> 5] |= 128 << 24 - q % 32;
                h[(q + 64 >>> 9 << 4) + 14] = Math.floor(n / 4294967296);
                h[(q + 64 >>> 9 << 4) + 15] = n;
                e.sigBytes = 4 * h.length;
                this._process();
                return this._hash
            },
            clone: function () {
                var e = q.clone.call(this);
                e._hash = this._hash.clone();
                return e
            }
        });
    h.SHA1 = q._createHelper(n);
    h.HmacSHA1 = q._createHmacHelper(n)
})(this);
(function (h, n) {
    "function" !== typeof define || !define.amd || "undefined" != typeof nonUseAmd && nonUseAmd ? n() : "undefined" != typeof HTMLDev && HTMLDev ? define(["./core/kinggrid.plus"], n) : define(["./core/kinggrid.plus.min"], n)
})(window, function (h) {
    function n(a) {
        a = JSON.stringify(a);
        return A ? a.replace(/\\u([0-9a-fA-F]{2,4})/g, function (a, c) {
            return String.fromCharCode(parseInt(c, 16))
        }) : a
    }
    function r(a, b, c) {
        var f = [],
            k = {},
            l;
        for (l in a) {
                var p = {},
                    y = a[l];
                g.is("String", y) && (A || 0 != y.indexOf("ey")) ? (p["b64_" + l] = a[l], f.push(p)) : k[l] = y
            }
        var m = [];
            (function (a) {
                for (var b in a) m.push((new d(b, a[b])).load(d.options))
            })(k);
        if (a = f.length) for (k = d.options.signSize || 5, l = Math.ceil(a / k), p = 1; p <= l; p++) {
                var y = k * (p - 1),
                    h = k * p > a ? a : k * p;
                G = e.surry(d.options.serverUrl);
                G.request(d.options.b64Url, f.slice(y, h)).ret(function (a) {
                        if (a.result) for (var b in a) {
                            if (0 == b.indexOf("b64_")) {
                                var c = a[b];
                                g.is("String", c) && (c = JSON.parse(c));
                                m.push((new d(b.substring(4), c)).load(d.options))
                            }
                        } else d.prototype.error.call(null, a)
                    })
            }
        G.fin(function (a, f, d) {
                b && b(1 == m.length ? m[0] : m);
                c && c()
            })
    }
    var q = window,
        e = window.kinggrid,
        m = window.jQuery,
        v = window.kingPlus,
        A = !1;
    q.JSON && (A = '{"x":"\u4e2d"}' !== q.JSON.stringify({
            x: "\u4e2d"
        }));
    var F = !0;
    try {
            q.document.createElement("canvas").getContext("2d")
        } catch (a) {
            F = !1
        }
    var g = e.Utils,
        D = m(window),
        B = m(document);
    h = document.documentElement;
    var t = !! ("minWidth" in h.style) && "onlosecapture" in h,
        w = "setCapture" in h,
        x, C, L = function (a) {
            x && (a = a.originalEvent ? a.originalEvent.touches.item(0) : a.touches.item(0));
            return a
        },
        K = function (a) {
            this.start = m.proxy(this.start, this);
            this.over = m.proxy(this.over, this);
            this.end = m.proxy(this.end, this);
            this.onstart = this.onover = this.onend = m.noop;
            C || (x = "mousedown" != a.type, C = {
                start: x ? "touchstart" : "mousedown",
                over: x ? "touchmove" : "mousemove",
                end: x ? "touchend" : "mouseup"
            })
        };
    K.prototype = {
            start: function (a) {
                a = this.startFix(a);
                z.trigger("dragStart", this, a);
                B.on(C.over, this.over).on(C.end, this.end);
                this.onstart(a);
                return !1
            },
            over: function (a) {
                a = this.overFix(a);
                z.trigger("dragOver", this, a);
                this.onover(a);
                return !1
            },
            end: function (a) {
                a = this.endFix(a);
                z.trigger("dragEnd", this, a);
                B.off(C.over, this.over).off(C.end, this.end);
                this.onend(a);
                return !1
            },
            startFix: function (a) {
                a = L(a);
                this.target = m(a.target);
                this.selectstart = function () {
                    return !1
                };
                B.on("selectstart", this.selectstart).on("dblclick", this.end);
                if (t) this.target.on("losecapture", this.end);
                else D.on("blur", this.end);
                w && this.target[0].setCapture();
                return a
            },
            overFix: function (a) {
                return a = L(a)
            },
            endFix: function (a) {
                a = L(a);
                B.off("selectstart", this.selectstart).off("dblclick", this.end);
                t ? this.target.off("losecapture", this.end) : D.off("blur", this.end);
                w && this.target[0].releaseCapture();
                return a
            }
        };
    K.create = function (a, b, c) {
            var f = m(a),
                d = new K(b),
                l = C.start,
                p = function () {},
                y = a.className.replace(/^\s|\s.*/g, "") + "-drag-start",
                e = f[0].style,
                g, M, h, n, q = 0,
                t = 0,
                N = parseInt(e.left),
                O = parseInt(e.top),
                r = N,
                u = O,
                v = N,
                w = O;
            c && (r = parseInt(e.marginLeft), u = parseInt(e.marginTop), v = r, w = u);
            var x = {
                    onstart: p,
                    onover: p,
                    onend: p,
                    off: function () {
                        f.off(l, d.start)
                    }
                };
            d.onstart = function (b) {
                    var c = "fixed" === f.css("position"),
                        d = B.scrollLeft(),
                        k = B.scrollTop(),
                        l = f.width(),
                        p = f.height();
                    M = g = 0;
                    h = c ? D.width() - l + g : B.width() - l;
                    n = c ? D.height() - p + M : B.height() - p;
                    p = f.offset();
                    l = this.startLeft = c ? p.left - d : p.left;
                    c = this.startTop = c ? p.top - k : p.top;
                    this.clientX = b.clientX;
                    this.clientY = b.clientY;
                    p = f.parent();
                    p.is("body") || (q = p[0].getBoundingClientRect().left + d, t = p[0].getBoundingClientRect().top + k);
                    f.addClass(y);
                    x.onstart.call(a, b, l, c)
                };
            d.onover = function (b) {
                    var d = b.clientX - this.clientX + this.startLeft,
                        k = b.clientY - this.clientY + this.startTop,
                        l = f[0].style,
                        d = Math.max(g, Math.min(h, d)),
                        k = Math.max(M, Math.min(n, k));
                    c ? (d = l.marginLeft = d - q - N + "px", k = l.marginTop = k - t - O + "px") : (d = l.left = d - q + "px", k = l.top = k - t + "px");
                    v = parseInt(d);
                    w = parseInt(k);
                    x.onover.call(a, b, d, k)
                };
            d.onend = function (b) {
                    var d = f.position(),
                        k = d.left,
                        d = d.top;
                    f.removeClass(y);
                    var l = f[0].style,
                        p = !0;
                    6 > Math.abs(v - r) && 6 > Math.abs(w - u) && (p = !1);
                    c ? x.onend.call(a, b, p, l.marginLeft, l.marginTop) : x.onend.call(a, b, p, k, d)
                };
            d.off = function () {
                    f.off(l, d.start)
                };
            if (b) d.start(b);
            else f.on(l, d.start);
            return x
        };
    h = e.Listener;
    var E = function () {};
    m.extend(E.prototype, h.prototype);
    var H = function () {};
    H.className = H.name || "SealService";
    g.inherit(H, E);
    m.extend(H.prototype, {
            loadSeal: function () {
                throw Error("must impl");
            },
            saveLog: function () {},
            verifyPwd: function () {
                throw Error("must impl");
            }
        });
    var I = function () {};
    I.className = I.name || "CertService";
    g.inherit(I, E);
    m.extend(I.prototype, {
            sign: function () {
                throw Error("must impl");
            },
            verifySign: function () {
                throw Error("must impl");
            }
        });
    E = function () {};
    m.extend(E.prototype, {
            getAttr: function (a) {
                return this[a]
            },
            setAttr: function (a) {
                var b =
                this;
                m.each(a, function (a, f) {
                    if ("function" === typeof b[a]) b[a](f);
                    else b[a] = f
                })
            },
            removeAttr: function (a) {
                delete this[a]
            }
        });
    var d = function (a, b) {
            var c = this;
            c.signatureid = a;
            c.setSignatureData(b);
            c.on("load", function () {
                d.list[a] = this
            });
            c.on("remove", function (a) {
                a = c._getLogInfo(g.extend(a || {}, {
                    LOGTYPE: "00",
                    LOGSORT: "14",
                    LOGMEMO: "\u64a4\u9500\u7b7e\u7ae0\u6210\u529f"
                }));
                c.sealService.saveLog(a);
                delete d.list[c.signatureid]
            });
            c.on("update", function (a) {
                "signMeta" === c._item && (a = c._getLogInfo(g.extend(a || {}, {
                    LOGTYPE: "00",
                    LOGSORT: "304",
                    LOGMEMO: "\u6570\u5b57\u7b7e\u540d\u6210\u529f"
                })), c.sealService.saveLog(a))
            });
            c.on("fireremove", function () {
                d.removeList.push(c.signatureid)
            });
            c.on("fireupdate", function () {
                for (var a = !1, b = 0; b < d.updateList.length; b++) if (d.updateList[b] === c) {
                    a = !0;
                    break
                }
                a || d.updateList.push(c)
            });
            for (var f in d) d.hasOwnProperty(f) && 0 == f.indexOf("on") && (this[f] = d[f]);
            return this
        },
        P = function (a, b, c) {
            var f;
            if (F) {
                f = q.document.createElement("canvas");
                f.height = c;
                f.width = b;
                var d = f.getContext("2d"),
                    l = new Image;
                l.src =
                a;
                l.onload = function () {
                        d.drawImage(l, 0, 0, b, c)
                    }
            } else f = q.document.createElement("img"),
            f.style.width = b + "px",
            f.style.height = c + "px",
            f.setAttribute("src", a);
            return f
        };
    g.inherit(d, E);
    m.extend(d.prototype, h.prototype);
    m.extend(d.prototype, {
            hashAlg: "sha1",
            encryptAlg: "RSA",
            _init: function () {},
            _getLogInfo: function (a) {
                var b = decodeURIComponent(window.location.href),
                    c = this.signatureData;
                return g.extend(a || {}, {
                        KEYSN: c.keysn,
                        SIGNSN: c.seal.signsn,
                        DOCUMENTID: c.documentid,
                        DOCUMENTNAME: c.documentname,
                        APPVERSION: Q.name,
                        APPTYPE: "HTML",
                        APPCODE: this.appcode,
                        EXTPARAM2: b
                    })
            },
            error: function (a, b, c) {
                var f = a;
                g.is("Object", a) && (f = a.errcode && "511" != a.errcode ? a.errcode : a.errmsg);
                f || (f = "-999");
                b = g.is("String", b) ? b : "then";
                d.options.errorCall ? (u.hideLoading(), d.options.errorCall.call(null, a, b)) : u.alert(e.msg(f, b), function () {
                    u.hideLoading();
                    return g.is("Function", c) ? c() : !0
                })
            },
            load: function (a) {
                this.trigger("beforeLoad");
                this.setAttr(a);
                this.certService = new d.factory.cert[d.options.certType](a, this.signatureData);
                var b = this.signatureData;
                void 0 !== a.extra && null !== a.extra && void 0 !== a.extra[this.signatureid] ? (void 0 !== a.extra[this.signatureid].scaleImage && null !== a.extra[this.signatureid].scaleImage && (b.seal.height *= a.extra[this.signatureid].scaleImage, b.seal.width *= a.extra[this.signatureid].scaleImage), void 0 != a.extra[this.signatureid].position && (this.removeItem(b.position), this.updatePos(a.extra[this.signatureid].position, {
                    marginLeft: a.extra[this.signatureid].offsetX,
                    marginTop: a.extra[this.signatureid].offsetY
                }))) : void 0 !== a.scaleImage && null !== a.scaleImage && (b.seal.height *= a.scaleImage, b.seal.width *= a.scaleImage);
                this.sealService = new d.factory.seal[d.options.sealType](a, b);
                this._init();
                this.trigger("load");
                return this
            },
            toBase64Img: function (a) {
                var b = a.imgdata,
                    c = b.indexOf(a.signsn);
                if (-1 == c) return b;
                b = a.imgdata.substring(c + 65);
                return g.Base64.of().encodeByte(g.Base64.of(a.signsn).decodeByte(b))
            },
            clearImg: function () {
                if (this.imgEles) for (var a in this.imgEles) this.trigger("removeAt", this.imgEles[a][0]),
                this.imgEles[a].remove();
                this.imgEles = {}
            },
            repaint: function () {
                this.clearImg();
                this.verify()
            },
            getUpdateType: function () {
                return this._item
            },
            updatePos: function (a, b) {
                var c = this.signatureData.position[a];
                this._item = "position";
                this.signatureData.position[a] = g.extend({}, c, b)
            },
            updateItem: function (a, b) {
                this._item = a;
                this.signatureData[a] = b
            },
            removeItem: function (a) {
                for (var b in a) delete a[b]
            },
            fireUpdate: function (a) {
                var b = this,
                    c = function (c) {
                        a && a(c);
                        b[c ? "update" : "restore"]();
                        delete b._item
                    };
                d.asyn.update ? d.asyn.update.call(b, c) : (this.trigger("fireupdate"), c(!0));
                return this
            },
            restore: function () {
                this.setSignatureData(this.oriSignatureData);
                this.repaint()
            },
            update: function () {
                this.setSignatureData(this.signatureData);
                this.repaint();
                this.trigger("update");
                return this
            },
            remove: function () {
                this.clearImg();
                this.trigger("remove");
                for (var a in this) delete this[a];
                return this
            },
            fireRemove: function (a) {
                var b = this,
                    c = function (c) {
                        a && a(c);
                        c && b.remove()
                    };
                d.asyn.remove ? d.asyn.remove.call(b, c) : (this.trigger("fireremove"), c(!0));
                return this
            },
            hide: function () {
                if (this.imgEles) for (var a in this.imgEles) this.imgEles[a].hide()
            },
            createImg: function () {
                var a = this.signatureData,
                    b = m(document.createElement("img")),
                    c = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=";
                this.broken || (c = "data:image/" + a.seal.imgext + ";base64," + this.toBase64Img(a.seal));
                b.css({
                        width: Math.ceil(9600 * parseFloat(a.seal.width) / 254),
                        height: Math.ceil(9600 * parseFloat(a.seal.height) / 254)
                    }).attr({
                        src: c
                    });
                return b
            },
            show: function () {
                var a = this.signatureData.position,
                    b = this.imgEles = this.imgEles || {},
                    c;
                for (c in a) {
                        var f = "kg-img-div-" + this.signatureid + "-" + c,
                            d = b[f];
                        d || (d = b[f] = this.showAt(c, a[c]));
                        this._handleImg(d)
                    }
                this.trigger("show")
            },
            showAt: function (a, b) {
                this.trigger("beforeShowAt", a, b);
                var c = g.$(a),
                    f = m(c);
                this.extra && this.extra[this.signatureid] && (c = this.extra[this.signatureid].scopePosition) && (f = c instanceof Object ? c.find("#" + a) : m(g.$(c)).find("#" + a));
                if (0 == f.length) if (d.options.defaultPos) a = d.options.defaultPos,
                f = m(g.$(a));
                else throw Error("no find position:" + a + " signatureid=" + this.signatureid);
                var k = this.createImg();
                k.addClass("kg-img").attr("id", "kg-img-" + this.signatureid);
                c = m(document.createElement("div")).addClass("kg-img-div").addClass("kg-img-div-" + a).attr({
                        id: "kg-img-div-" + this.signatureid + "-" + a,
                        elemid: a,
                        signatureid: this.signatureid
                    });
                c.append(k);
                c.css({
                        width: k.width(),
                        height: k.height()
                    });
                var l = 0,
                    p = 0,
                    e = this.signatureData.dateTime;
                null != e && e.isCheck && e.fontDate && (this.addDateToImg(e.fontDate, this.signatureData.timestamp.time, c), null != this.imageAndDate && this.imageAndDate && "outside" == e.fontDate.fontPosition[2] && ("right" == e.fontDate.fontPosition[3] ? l += c.width() : "left" == e.fontDate.fontPosition[3] && (l += c.width()), "below" == e.fontDate.fontPosition[4] && (p += c.height())));
                c.css({
                        width: k.width() + l,
                        height: k.height() + p
                    });
                k = c;
                l = "kg-default";
                if (e = f.attr("display")) f.addClass("display-" + e),
                l = "kg-" + e,
                p = f,
                k = document.getElementById("kg-img-container-" + a),
                k || (k = document.createElement("div"), k.setAttribute("id", "kg-img-container-" + a)),
                k = m(k).addClass(l + "-container"),
                k.append(c),
                c.attr("kg-display", !0);
                else if (p = f.offsetParent(), "html" == p[0].tagName.toLowerCase() || "relative" == p[0].style.position) p = m("body");
                c.addClass(l);
                p.append(k);
                if (e) {
                        if ("landscape" === e) {
                            var f = k.children(),
                                l = k.parent().width(),
                                h = 0;
                            f.each(function () {
                                    h += parseInt(m(this).width()) + 1
                                });
                            k.width(h > l ? h : l)
                        }
                    } else this.calSealPos(f, c, k, b);
                this.trigger("showAt", c[0], a, b);
                return c
            },
            calSealPos: function (a, b, c, f) {
                var d = a.offsetParent();
                c = c || b;
                if ("html" == d[0].tagName.toLowerCase() || "relative" == d[0].style.position) d = m("body");
                a = a.offset();
                var l = d.offset();
                d.is("body") && (l = {
                    top: 0,
                    left: 0
                });
                c.css({
                    top: a.top - l.top,
                    left: a.left - l.left
                });
                f ? (d = f.marginLeft, f = f.marginTop) : (d = b.css("marginLeft"), f = b.css("marginTop"));
                b.css({
                    marginLeft: d || 0,
                    marginTop: f || 0
                })
            },
            addDateToImg: function (a, b, c) {
                b = e.Utils.formatDate(new Date(b), a.fontFormat);
                var f = m(document.createElement("div")).addClass("kg-date"),
                    d = 0,
                    l = 0;
                "outside" == a.fontPosition[2] && ("right" == a.fontPosition[3] ? d += c.width() : "left" == a.fontPosition[3] && (d -= c.width()), "below" == a.fontPosition[4] && (l += c.height()));
                f.css({
                        width: c.width(),
                        height: c.height(),
                        top: l,
                        left: d
                    });
                d = m(document.createElement("div")).addClass("kg-date-tmb").css({
                        width: c.width()
                    });
                l = m(document.createElement("div")).addClass("kg-date-lcr").css({
                        "text-align": a.fontPosition[0],
                        "font-family": a.fontFamily,
                        "font-size": a.fontSize + "px",
                        color: a.fontColor
                    });
                "bottom" == a.fontPosition[1] ? d.css({
                        bottom: 0
                    }) : "middle" == a.fontPosition[1] && l.css({
                        "line-height": c.height() + "px"
                    });
                l.html(b);
                d.html(l);
                f.html(d);
                c.append(f)
            },
            canSign: function () {
                return !this.modified && !d.options.readonly && d.options.signable && !this.signatureData.signMeta
            },
            canMove: function (a) {
                (a = !d.options.readonly && this.signatureData.moveable && d.options.moveable && !m(a).attr("kg-display")) && d.options.moveable_self && (a = this.signatureData.keysn == d.options.keysn);
                return a
            },
            canDelete: function () {
                return !d.options.readonly
            },
            _handleImg: function (a) {
                a.show();
                if (0 == a.children(".kg-shade").length) {
                    var b = m(document.createElement("div")).addClass("kg-shade");
                    b.append(P("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVR42mNgAAIAAAUAAen63NgAAAAASUVORK5CYII=", a.width(), a.height()));
                    a.append(b)
                }
                this._invalid(a);
                this.trigger("handleImg", a[0])
            },
            setSignatureData: function (a) {
                g.is("String", a) ? this.signatureData = JSON.parse(g.Base64.of().decode(a)) : this.signatureData = a;
                this.oriSignatureData = JSON.parse(JSON.stringify(this.signatureData))
            },
            getSignatureid: function () {
                return this.signatureid
            },
            getSignatureData: function () {
                var a = JSON.stringify(this.signatureData);
                return g.Base64.of().encode(a)
            },
            getBase64Image: function (a, b, c, f) {
                c = "kg-img-div-" + a + "-" + c;
                c = document.getElementById(c);
                null != c && (A ? f(this, "", a, b) : html2canvas(c).then(function (c) {
                    c = c.toDataURL("image/png").split(",");
                    f(this, c, a, b)
                }))
            },
            _invalid: function (a) {
                var b = a.children(".kg-invalid");
                if (0 == b.length) {
                    b = m(document.createElement("div")).addClass("kg-hide").addClass("kg-invalid");
                    a.append(b);
                    var c = a.height() / 3;
                    b.css({
                        top: c,
                        height: c
                    });
                    for (var c = c / 3, f = a.width(), d = 0; 3 > d; d++) {
                        var l = m(document.createElement("div")).height(c);
                        0 == d % 2 && (l.addClass("kg-invalid-item"), l.append(P("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR42mNoaGgAAAMEAYF1LgG8AAAAAElFTkSuQmCC", f, c)));
                        b.append(l)
                    }
                }
                if (this.modified) {
                    c = "";
                    for (f = 0; f < this.modifiedItems.length; f++) d = this.modifiedItems[f],
                    c += d.desc + "[" + d.field + "]\u7531{" + d.orivalue + "}\u66f4\u6539\u4e3a{" + d.newvalue + "};";
                    a.attr("modified", c).addClass("error");
                    b.removeClass("kg-hide")
                } else a.removeAttr("modified").removeClass("error"),
                b.addClass("kg-hide")
            },
            _verify: function (a, b) {
                this.trigger("before_verify");
                var c = this.verifyProtectedData(a);
                if (!b || b && b.batchVerify || null == this.oriSignatureData.timestamp.timestampInfo) return this.show(),
                this.trigger("_verify"),
                !c;
                var d = this;
                this.getVerifyTimeStamp(this.oriSignatureData.timestamp.timestampInfo, function (a) {
                    d.timeVerify = a;
                    d.show();
                    d.trigger("_verify");
                    b && b.sucCall && b.sucCall.call(d)
                })
            },
            verify: function (a, b) {
                this.trigger("beforeVerify");
                var c = this._verify(a, b);
                this.trigger("verify");
                return c
            },
            getVerifyProtectedData: function () {
                for (var a = this.validatedData, b = this.signatureData.protectedData, c = {}, d = 0; d < b.length; d++) {
                    var k = b[d],
                        l = k.field,
                        p = a && a[l];
                    if (!p) {
                            var e = g.$(l);
                            if (e) {
                                if (p = e.getAttribute("kg-value") || e.value, void 0 === p || null === p) p = e.innerHTML || e.innerText
                            } else p = void 0 != k.name && null != k.name ? document.getElementById(k.name).value : ""
                        }
                    k = g.val(p, this);
                    k = this._formatValue(k);
                    c[l] = k
                }
                return c
            },
            getSignTimeStamp: function (a) {
                for (var b = {}, c = 0; c < a.length; c++) b[a[c].field] = a[c].value;
                return g.Base64.of().encode(n(b))
            },
            getValidatedTimeStamp: function () {
                var a = this.getVerifyProtectedData(),
                    a = n(a);
                return g.Base64.of().encode(a)
            },
            getVerifyTimeStamp: function (a, b) {
                var c = this.getValidatedTimeStamp(),
                    f = a.CertData,
                    k =
                e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                k.invoke("SetParamByName", "TSCERTDATA", g.Base64.of().encode(f)).ret(function () {
                        k.invoke("KGVerifyTSWithReq", a.TimeStampResponse, a.TimeStampResult, "", c, a.TimeStr, "").ret(function (a) {
                            b.call(this, a.result)
                        })
                    })
            },
            getH5SignData: function () {
                var a = this.hashAlg,
                    b = this.encryptAlg,
                    c = CryptoJS.SHA1(this.getSignData()).toString();
                return [{
                        hashAlg: a,
                        encryptAlg: b,
                        signdata: c
                    }]
            },
            verifyProtectedData: function (a) {
                a && (this.validatedData =
                a);
                a = [];
                for (var b = this.getVerifyProtectedData(), c = this.signatureData.protectedData, d = 0; d < c.length; d++) {
                    var k = c[d],
                        l = b[c[d].field];
                    l !== k.value && a.push({
                            field: k.field,
                            desc: k.desc,
                            orivalue: k.value,
                            newvalue: l
                        })
                }
                this.modified = 0 < a.length;
                this.modifiedItems = a;
                return this.modified
            },
            verifySignData: function (a) {
                var b = this;
                u.showLoading();
                var c = this.certService,
                    f;
                if (this.signatureData.signMeta.html2sign) {
                        c instanceof J || (c = new J(d.options), c.sData = b.signatureData);
                        f = b.getVerifyProtectedData();
                        for (var k = this.signatureData.protectedData, l = [], p = 0; p < k.length; p++) {
                            var e = k[p],
                                g = {},
                                h;
                            for (h in e) e.hasOwnProperty(h) && (g[h] = e[h]);
                            g.value = f[e.field];
                            l.push(g)
                        }
                        f = n(l)
                    } else f = this.getValidatedSignData();
                c.verifySign(m.extend({
                        seal: this.signatureData.seal,
                        signeddata: this.signatureData.signMeta.signeddata,
                        crtdata: this.signatureData.signMeta.certinfo.crtdata,
                        keysn: this.signatureData.keysn,
                        signsn: this.signatureData.seal.signsn,
                        signdata: f
                    }, {
                        successCall: function (c) {
                            u.hideLoading();
                            var d;
                            c.errcode || (b.signModified = !c.result, d = b.verify(null, {
                                sucCall: function () {
                                    a && a(c)
                                }
                            }));
                            null != d && a && a(c)
                        }
                    }))
            },
            _renderValue: function (a) {
                return a.replace(/\r\n/ig, "<br>")
            },
            _formatValue: function (a, b) {
                var c = a;
                c && (c = c.replace(/\r\n/ig, "\n"), c = c.replace(/\n/ig, "\r\n"));
                return c
            },
            getItemVal: function (a) {
                var b;
                if (b = g.is("String", a) ? g.$(a) : a) return a = b.tagName.toLowerCase(),
                "input" === a || "textarea" === a || "select" === a || "div" === a ? b.getAttribute("kg-value") || b.value : b.getAttribute("kg-value") || (A ? b.innerText : b.textContent);
                throw Error("No find protectedItem:" + a + " signatureid=" + this.signatureid);
            },
            getProtectedData: function (a) {
                var b = this,
                    c = [],
                    d = function (a) {
                        var c = g.$(a);
                        if (c) {
                            var d = {
                                field: a
                            };
                            d.desc = c.getAttribute("kg-desc") || a;
                            d.value = b.getItemVal(c);
                            return d
                        }
                        throw Error("No find protectedItem:" + a + " signatureid=" + this.signatureid);
                    },
                    k = function (a) {
                        if (g.is("String", a)) a = d(a);
                        else if (!g.is("Object", a) || !a.field) throw Error("Unsupported protectedItems:" + a.toString);
                        g.is("Function", a.value) && (a.value = a.value.call(b, a.field, a.desc));
                        a.value = b._formatValue(a.value);
                        return a
                    };
                if (a) if (g.is("Array", a)) for (var l = 0, e = a.length; l < e; l++) c.push(k(a[l]));
                else c.push(k(a));
                return c
            },
            __findSignedData: function (a) {
                if (g.is("String", a)) return a.split(";")[0];
                if (g.is("Array", a)) return a[0];
                throw Error("error signeddata: " + a);
            },
            getValidatedSignData: function () {
                var a = this.getVerifyProtectedData(),
                    a = n(a),
                    a = g.Base64.of().encode(a);
                return CryptoJS.SHA1(a).toString()
            },
            getSignData: function (a) {
                a = (a || this.signatureData).protectedData;
                for (var b = {}, c = 0; c < a.length; c++) b[a[c].field] = a[c].value;
                return g.Base64.of().encode(n(b))
            },
            showSignSignatureDialog: function (a) {
                var b = {
                    target: g.is("Array", a.target) ? a.target : [a.target],
                    title: e.msg("SignSignature", "KG_TITLE"),
                    onShow: function () {
                        var a = this;
                        setTimeout(function () {
                            a.find("#kg-password").focus()
                        }, 40);
                        a.find("#kg-password").keydown(function (b) {
                            13 == b.keyCode && a.options.onOk.call(a)
                        })
                    },
                    onOk: function () {
                        var b = this.find("#kg-password");
                        if (!b.val()) return u.alert(e.msg("in_pwd_msg", "KG_MSG"), function () {
                            b.focus()
                        }),
                        !1;
                        a._onOk.call(this, b.val());
                        return !1
                    }
                };
                return this.showDialog("signSignatureBtl", b)
            },
            signSignature: function (a) {
                var b = this,
                    c = {
                        target: b,
                        _onOk: function (c) {
                            var d = this,
                                f = b.getH5SignData();
                            b.runSign(f, c, function (c) {
                                    c.result ? b.fireUpdate(function (a) {
                                        a && d.remove && d.remove()
                                    }) : b.error(c);
                                    a && a(c)
                                })
                        }
                    };
                if ("client" == d.options.sealType && d.options.phoneshield) c._onOk("");
                else return b.showSignSignatureDialog(c)
            },
            showRevokeSignatureDialog: function (a) {
                var b = {
                    target: g.is("Array", a.target) ? a.target : [a.target],
                    title: e.msg("RevokeSignature", "KG_TITLE"),
                    quickClose: void 0 == d.options.quickClose ? !0 : d.options.quickClose,
                    onShow: function () {
                        var a = this;
                        setTimeout(function () {
                            a.find("#kg-password").focus()
                        }, 40);
                        a.find("#kg-password").keydown(function (b) {
                            13 == b.keyCode && a.options.onOk.call(a)
                        })
                    },
                    onOk: function () {
                        var b = this.find("#kg-password");
                        if (!b.val()) return u.alert(e.msg("in_pwd_msg", "KG_MSG"), function () {
                            b.focus()
                        }),
                        !1;
                        a._onOk.call(this, b.val());
                        return !1
                    }
                };
                return this.showDialog("revokeSignatureBtl", b)
            },
            revokeSignature: function (a) {
                var b = this,
                    c = {
                        target: b,
                        _onOk: function (c) {
                            var f = this;
                            u.showLoading();
                            b.sealService.verifyPwd({
                                pwd: c,
                                keysn: b.signatureData.keysn,
                                successCall: function (c) {
                                    u.hideLoading();
                                    c.result ? void 0 !== d.options.delCallBack && d.options.delCallBack ? d.options.delCallBack(b.signatureid, b.signatureData) && b.fireRemove(function (a) {
                                        a && (f.remove ? f.remove() : b.remove())
                                    }) : b.fireRemove(function (a) {
                                        a && (f.remove ? f.remove() : b.remove())
                                    }) : b.error(c);
                                    a && a(c)
                                }
                            })
                        }
                    };
                if ("client" == d.options.sealType && d.options.phoneshield) c._onOk("");
                else if (d.options.showNoPW && "server" == d.options.sealType) c._onOk(d.options.password);
                else return b.showRevokeSignatureDialog(c)
            },
            showDialog: function (a, b) {
                var c = g.is("Array", b.target) ? b.target : [b.target],
                    f = {
                        title: e.msg("KinggridSignature", "KG_TITLE"),
                        onShow: function () {
                            var a = this;
                            setTimeout(function () {
                                a.find("#kg-password").focus()
                            }, 40);
                            a.find("#kg-password").keydown(function (b) {
                                13 == b.keyCode && a.options.onOk.call(a)
                            })
                        },
                        onCancel: b.errCall ||
                        function () {
                            u.hideLoading();
                            return !0
                        },
                        content: function () {
                            var b = [d.options.template[a]].concat(c);
                            return g.template.apply(null, b)
                        }
                    },
                    f = g.extend(f, b),
                    f = u.showDialog(a, f);
                if ("showSealsBtl" === a) {
                        var k =
                        f.find("#sealTpl-dialog"),
                            l = !1,
                            p = 0,
                            y = 0,
                            h = 0,
                            m = 0;
                        k.prevObject[0].onmousedown = function (a) {
                                l = !0;
                                a = a || event;
                                p = a.clientX;
                                y = a.clientY;
                                h = parseInt(k.prevObject[0].style.top);
                                m = parseInt(k.prevObject[0].style.left)
                            };
                        k.prevObject[0].onmousemove = function (a) {
                                if (l) {
                                    a = a || event;
                                    var b = m + a.clientX - p;
                                    a = h + a.clientY - y;
                                    0 < b && 0 < a && (k.prevObject[0].style.left = b + "px", k.prevObject[0].style.top = a + "px")
                                }
                            };
                        k.prevObject[0].onmouseup = function (a) {
                                l && (l = !1, m = h = y = p = 0)
                            }
                    }
                return f
            },
            runMove: function (a, b, c) {
                var f = this;
                z.trigger("startMove", f, a, b);
                return "client" == d.options.sealType && d.options.moveable_self && f.keysn != f.signatureData.keysn ? (d.alert(e.msg("cannot_move", "KG_MSG")), !1) : function (a, b, c) {
                    b = K.create(b, a, !0);
                    b.onend = function (a, b, d, l) {
                        c && c(b, d, l);
                        z.trigger("endMove", f, a, d, l);
                        b && (a = m(this), f.updatePos(a.attr("elemid"), {
                            marginLeft: d,
                            marginTop: l
                        }), f.fireUpdate())
                    };
                    a.preventDefault();
                    return b
                }(a, b, c)
            },
            runSign: function (a, b, c) {
                var f = this,
                    e = f.signatureData;
                u.showLoading();
                f.certService.sign({
                        seal: this.signatureData.seal,
                        keysn: this.signatureData.keysn,
                        signsn: this.signatureData.seal.signsn,
                        password: b,
                        signMeta: a,
                        successCall: function (b) {
                            u.hideLoading();
                            b.result && (b.signeddata ? (b.certinfo.algName = b.certinfo.algName.toUpperCase(), f.updateItem("signMeta", {
                                hashAlg: a[0].hashAlg,
                                encryptAlg: a[0].encryptAlg,
                                signdata: a[0].signdata,
                                signeddata: f.__findSignedData(b.signeddata),
                                certinfo: b.certinfo
                            })) : (b.result = !1, b.errcode = "signErr"), e.certType = d.options.certType);
                            c && c(b)
                        }
                    })
            },
            isPhoneShield: function () {
                return "client" == d.options.sealType && d.options.phoneshield ? !0 : !1
            }
        });
    var u = v();
    d.options = m.extend({
            b64Url: "/iWebSignature_base64",
            imageUrl: "/iWebSignature_image"
        }, e.options, {
            dialogConfig: {
                okValue: "\u786e  \u5b9a",
                cancelValue: "\u53d6  \u6d88",
                fixed: !0,
                backdropOpacity: .2,
                modal: !0
            },
            template: {}
        }, window.KGCONFIG);
    d.addProvider = function (a, b, c) {
            d.factory[a][b] = c
        };
    var G;
    d.init = function (a, b) {
            this.Seals = {};
            g.extend(d.options, a);
            var c = d.options;
            b = b ? b : a.okCall;
            c.serverUrl && (c.b64Url = "/signature/b64", c.imageUrl = "/signature/image", c.serverUrl += "/rest");
            "client" == c.sealType ? (c.clientUrl = c.https, G = d.aisleKing = e.surry(c.clientUrl ? c.clientUrl : "http://127.0.0.1:9581", "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319")) : G = d.aisleKing = e.surry(c.serverUrl || c.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
            var f = c.clientConfig;
            f && "client" === c.sealType ? d.AXI("SetParamByName", f, b) : b && b.call();
            z.trigger("init")
        };
    d.factory = {
            cert: {},
            seal: {}
        };
    d.SealService = H;
    d.CertService = I;
    d.asyn = {};
    d._create = function (a) {
            var b = this;
            b.setAttr(a);
            b.certService =
            new d.factory.cert[b.certType](a);
            b.sealService = new d.factory.seal[b.sealType](a);
            b.on("createSignature", function (a, d, e) {
                a = [];
                var c = b._getLogInfo({
                    LOGTYPE: "00",
                    LOGSORT: "13",
                    LOGMEMO: "\u76d6\u7ae0\u6210\u529f",
                    LOGSORTSUBCLASS: "1301"
                });
                a.push(g.extend(d || {}, c));
                e && a.push(b._getLogInfo({
                    LOGTYPE: "00",
                    LOGSORT: "304",
                    LOGMEMO: "\u6570\u5b57\u7b7e\u540d\u6210\u529f"
                }));
                b.sealService.saveLog(a)
            });
            return this
        };
    v = function () {};
    v.prototype = d.prototype;
    v = new v;
    d._create.prototype = v;
    m.extend(v, {
            keyData: null,
            sealExpired: function (a, b, c, f, e) {
                var l = this,
                    k = !0;
                if (void 0 === d.options.valid || null === d.options.valid || !1 === d.options.valid) return l.certExpired(b, c, f);
                if (void 0 !== a.endata && null !== a.endata) {
                        var y = a.endata;
                        e = parseInt(c.substr(0, 4));
                        a = parseInt(c.substr(5, 2));
                        var k = parseInt(c.substr(8, 2)),
                            h = parseInt(y.substr(0, 4)),
                            g = parseInt(y.substr(5, 2)),
                            y = parseInt(y.substr(8, 2));
                        e > h ? (l.errorCallback({
                                errcode: "11104"
                            }, b.errorCall), k = !1) : e == h ? a > g ? (l.errorCallback({
                                errcode: "11104"
                            }, b.errorCall), k = !1) : a == g ? k > y ? (l.errorCallback({
                                errcode: "11104"
                            }, b.errorCall), k = !1) : k = !0 : k = !0 : k = !0
                    } else return a = d.options.serverUrl + "/key/sealIsExpired",
                e = (parseInt(e) + 1).toString(),
                m.ajax({
                        url: a,
                        data: {
                            keysn: l.keyData.keysn,
                            year: (new Date).getFullYear(),
                            month: (new Date).getMonth(),
                            date: (new Date).getDate(),
                            index: e
                        },
                        async: !1,
                        success: function (a) {
                            if (a.error) return l.errorCallback({
                                errcode: "11105"
                            }, b.errorCall),
                            !1;
                            if (0 == a.result) return l.certExpired(b, c, f);
                            l.errorCallback({
                                errcode: "11104"
                            }, b.errorCall);
                            return !1
                        },
                        error: function (a) {
                            l.errorCallback({
                                errcode: "11105"
                            }, b.errorCall)
                        }
                    }),
                !1;
                return k ? l.certExpired(b, c, f) : k
            },
            certExpired: function (a, b, c) {
                var f = this,
                    k = !1;
                if (void 0 === d.options.valid || null === d.options.valid || !1 === d.options.valid) return !0;
                e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGGetCerInfo", "").ret(function (d) {
                        var e = parseInt(b.substr(0, 4)),
                            l = parseInt(b.substr(5, 2)),
                            h = parseInt(b.substr(8, 2));
                        if (d.result) {
                                d = d.certinfo.notAfter;
                                var g = parseInt(d.substr(0, 4)),
                                    m = parseInt(d.substr(4, 1)),
                                    m = 0 == m ? parseInt(d.substr(5, 1)) : parseInt(d.substr(4, 2)),
                                    n = parseInt(d.substr(6, 1)),
                                    n = 0 == n ? parseInt(d.substr(7, 1)) : parseInt(d.substr(6, 2));
                                e > g ? f.errorCallback({
                                        errcode: "11103"
                                    }, a.errorCall) : e == g ? l > m ? f.errorCallback({
                                        errcode: "11103"
                                    }, a.errorCall) : l == m ? h > n ? f.errorCallback({
                                        errcode: "11103"
                                    }, a.errorCall) : k = !0 : k = !0 : k = !0
                            } else f.errorCallback({
                                errcode: "11106"
                            }, a.errorCall);
                        void 0 !== c && null !== c && c(k)
                    });
                return k
            },
            errorCallback: function (a, b, c) {
                b ? (u.hideLoading(), b.call(null, a, c)) : this.error(a, c)
            },
            runHW: function (a, b) {
                var c = this;
                u.showLoading();
                "undefined" != typeof a.imageData && null != a.imageData && (void 0 !== a.beginCall && a.beginCall && a.beginCall.call(c), c.sealService.loadSeal({
                    data: a.imageData,
                    successCall: function (d) {
                        u.hideLoading();
                        if (d.result && d.seals) {
                            for (var f in d.seals) {
                                d.seals = [{
                                    width: a.width,
                                    height: a.height,
                                    imgext: d.seals[f].imgext,
                                    signname: a.name,
                                    signsn: d.seals[f].signsn,
                                    username: d.seals[f].username,
                                    imgdata: a.imageData,
                                    headinfoex: d.seals[f].headinfoex
                                }];
                                break
                            }
                            c.keyData = d;
                            c.showSeals(b)
                        } else c.errorCallback(d, a.errorCall)
                    },
                    errorCall: function (b) {
                        c.errorCallback(b, a.errorCall)
                    }
                }))
            },
            run: function (a) {
                var b = this;
                b.keyData ? b.showSeals(a) : (u.showLoading(), void 0 !== a.beginCall && a.beginCall && a.beginCall.call(b), b.sealService.loadSeal({
                    successCall: function (c) {
                        u.hideLoading();
                        c.result ? c.seals && c.seals.length ? (b.keyData = c, void 0 !== d.options.imgtag && 0 !== d.options.imgtag && void 0 === c.ServerTime ? void 0 !== b.serverUrl && null !== b.serverUrl ? (c = {
                            usercode: b.usercode,
                            keysn: b.keyData.keysn,
                            signname: b.signname,
                            authcode: d.authcode
                        }, e.surry(b.serverUrl).request("/key/load", c).ret(function (c) {
                            c.result ? (b.curDate = c.ServerTime, b.keyData = c, b.showSeals(a)) : b.errorCallback(c, a.errorCall)
                        })) : (b.curDate = (new Date).toLocaleString(), b.showSeals(a)) : (b.curDate = c.ServerTime, b.showSeals(a))) : b.errorCallback({
                            errcode: "11100" + d.options.imgtag
                        }, a.errorCall) : b.errorCallback(c, a.errorCall)
                    },
                    errorCall: function (c) {
                        b.errorCallback(c, a.errorCall)
                    }
                }));
                return this
            },
            getSealsByKeysn: function (a, b, c) {
                var d = this;
                d.sealService.loadSeal({
                    successCall: function (a) {
                        if (a.result) {
                            var c = [];
                            if (void 0 !== b && null != b) {
                                for (var f = 0; f < a.seals.length; ++f) c[f] =
                                d.toBase64Img(a.seals[f]);
                                b(c)
                            }
                        }
                    },
                    errorCall: function (a) {
                        d.errorCallback(a, c.errorCall)
                    }
                })
            },
            loadSeals: function (a, b) {
                var c = this;
                c.sealService.loadSeal({
                    successCall: function (b) {
                        void 0 !== a && null !== a && null !== b && void 0 !== b.seals && null !== b.seals && a(b)
                    },
                    errorCall: function (a) {
                        c.errorCallback(a, b && b.errorCall ? b.errorCall : null)
                    }
                })
            },
            runSS: function (a, b) {
                var c = this;
                if (null !== b) if (c.keyData = b, null == b.seals || 0 == b.seals.length) c.errorCallback({
                    errcode: "11107"
                }, a.errorCall);
                else if (void 0 !== d.options.imgtag && 0 !== d.options.imgtag && void 0 === b.ServerTime) if (void 0 !== c.serverUrl && null !== c.serverUrl) {
                    var f = {
                        usercode: c.usercode,
                        keysn: c.keyData.keysn,
                        signname: c.signname,
                        authcode: d.authcode
                    };
                    e.surry(c.serverUrl).request("/key/load", f).ret(function (b) {
                        b.result ? (c.curDate = b.ServerTime, c.keyData = b, c.showSeals(a)) : c.errorCallback(b, a.errorCall)
                    })
                } else c.curDate = (new Date).toLocaleString(),
                c.showSeals(a);
                else c.curDate = b.ServerTime,
                c.showSeals(a)
            },
            formatPos: function (a, b, c) {
                var d = {};
                if (a) {
                    var e = function (a) {
                        var f = a.elemid || a[0].id;
                        f || (f = "body");
                        d[f] = void 0 != b && void 0 != c ? {
                            marginLeft: b,
                            marginTop: c
                        } : g.filter(a, f)
                    };
                    if (g.is("Array", a)) for (var l = 0; l < a.length; l++) e(a[l]);
                    else g.is("String", a) ? d[a] = void 0 != b && void 0 != c ? {
                        marginLeft: b,
                        marginTop: c
                    } : {} : e(a)
                } else d.body = {};
                return d
            },
            exec: function (a, b, c, f, e, l) {
                var k = this;
                delete k.signatureData;
                var h = {
                    timestamp: {
                        time: void 0 == a.signtime ? (new Date).getTime() : (new Date(Date.parse(a.signtime.replace(/-/g, "/")))).getTime(),
                        signtime: void 0 == a.showtime ? a.signtime : a.showtime,
                        timestampInfo: a.timestampInfo
                    },
                    appname: navigator.userAgent,
                    documentid: void 0 == a.documentid ? k.documentid : a.documentid,
                    documentname: void 0 == a.documentname ? k.documentname : a.documentname,
                    moveable: g["boolean"](a, "moveable", d.options.moveable),
                    keysn: k.keyData.keysn,
                    orgname: k.keyData.orgname,
                    usercode: k.keyData.usercode,
                    username: k.keyData.username || c.username,
                    seal: c,
                    protectedData: k.getProtectedData(a.protectedItems),
                    sealType: a.sealType || k.sealType,
                    extparam: a.extparam,
                    ver: d.version,
                    dateTime: a.datetime
                };
                k.signatureData = h;
                k.certService.sData =
                k.signatureData;
                k.sealService.sData = k.signatureData;
                u.showLoading();
                var m = a.autoCert || k.autoCert,
                    n = function (a) {
                        var b = k.signatureData;
                        if (a && a.position) {
                            if (a.offsetX && a.offsetY) a.changeOffsetXY && a.changeOffsetXY(a),
                            b.position = k.formatPos(a.position, a.offsetX, a.offsetY);
                            else if (a.changeOffsetXY) {
                                var f = {
                                    width: Math.ceil(9600 * parseFloat(c.width) / 254),
                                    height: Math.ceil(9600 * parseFloat(c.height) / 254)
                                },
                                    f = a.changeOffsetXY(f);
                                b.position = k.formatPos(a.position, f.offsetX, f.offsetY)
                            } else b.position = k.formatPos(a.position);
                            f = a.signatureid || k.genId();
                            a && a.scopePosition && (void 0 == d.options.extra && (d.options.extra = {}), d.options.extra[f] = {
                                scopePosition: a.scopePosition
                            });
                            b.timeid = (new Date).getTime();
                            var e = (new d(f, b)).load(d.options);
                            a.okCall && (b = {
                                name: c.signname,
                                height: c.height,
                                width: c.width,
                                imgdata: k.toBase64Img(c)
                            }, a.isBatchSignature ? a.okCall.call(e, function (a) {
                                a || e.remove()
                            }, a.documentid) : a.okCall.call(e, function (b) {
                                b ? (k.trigger("createSignature", e, a.logMeta, m), e.show()) : e.remove()
                            }, b));
                            u.hideLoading()
                        } else throw Error("no set position");
                    };
                if (m) {
                        k.getSignData(h);
                        h = k.getH5SignData();
                        if (a.signMeta) h[g.is("Array", a.signMeta) ? "concat" : "push"](a.signMeta);
                        a.beforeSignCall && a.beforeSignCall.call(k, h);
                        e ? "client" == d.options.sealType ? k.runSign(h, f, function (d) {
                            d.result && (n(a), l && 1 < l.batchSignature.length && (a.documentid = l.batchSignature[l.batchSignature.length - 1].documentid, a.documentname = l.batchSignature[l.batchSignature.length - 1].documentname, --l.batchSignature.length, k.exec(a, b, c, f, e, l)));
                            b(d)
                        }) : k.runSign(h, f, function (c) {
                            c.result && n(a);
                            b(c)
                        }) : k.runSign(h, f, function (c) {
                            c.result && n(a);
                            b(c)
                        })
                    } else e ? n(a) : k.sealService.verifyPwd({
                        pwd: f,
                        keysn: h.keysn,
                        successCall: function (c) {
                            c.result && n(a);
                            b(c)
                        }
                    })
            },
            runPwd: function (a) {
                var b = this;
                b.showPwdDialog({
                    cancelCall: a.cancelCall,
                    _onOk: function (c) {
                        d.options.showNoPW = !0;
                        d.options.password = c;
                        var f = this.find("#kg-remenberPwd").is(":checked");
                        b.trigger("execSuccess", this, c, f);
                        b.run(m.extend(a, {
                            beginCancalCall: function () {
                                d.options.showNoPW = !1;
                                d.options.password = ""
                            }
                        }))
                    }
                })
            },
            showPwdDialog: function (a) {
                var b = this,
                    c = a._onOk;
                b.showDialog("passwordTpl", {
                        onCancel: a.cancelCall,
                        onShow: function () {
                            var a = this;
                            b.trigger("showSealsDialog_PW", a);
                            setTimeout(function () {
                                a.find("#kg-password").focus()
                            }, 40);
                            a.find("#kg-password").keydown(function (b) {
                                13 == b.keyCode && a.options.onOk.call(a)
                            })
                        },
                        onOk: function () {
                            var a = this.find("#kg-password"),
                                b = a.val();
                            b ? (c.call(this, b), this.remove()) : u.alert(e.msg("in_pwd_msg", "KG_MSG"), function () {
                                    a.focus()
                                });
                            return !1
                        },
                        content: function () {
                            return g.template.apply(null, [u.template.passwordTpl])
                        }
                    })
            },
            getPassCheck: function (a, b, c) {
                if (a && 1 == a) return a;
                if (void 0 === c || !0 === c || "auto" === c) try {
                    return b.find("#kg-remenberPwd").is(":checked")
                } catch (f) {}
                return !1
            },
            showSeals: function (a) {
                var b = this,
                    c = {
                        errorCall: a.errorCall,
                        cancelCall: a.cancelCall,
                        beginCancalCall: a.beginCancalCall,
                        protectedItems: a.protectedItems,
                        _onOk: function (c, f, k, l, h, m) {
                            var g = this,
                                p = new u.kgFont(null == g.fontSel ? null == b.signdate ? {} : b.signdate : g.fontSel),
                                y = g.isCheck;
                            !1 === d.options.showSealsDlg && d.options.signdate && d.options.signdate.ischeck && (y = d.options.signdate.ischeck);
                            a.datetime = {
                                    isCheck: y,
                                    fontDate: p
                                };
                            void 0 != l && null != l ? (a.signtime = l, void 0 != h && null != h ? (a.showtime = (l + " (" + h.TimeExt + ")").replace(/-/g, "/"), a.showtime += e.msg("timestamp_time", "KG_MSG"), a.timestampInfo = h) : (a.showtime = (new Date(Date.parse(l.replace(/-/g, "/")))).toLocaleString(), a.showtime += e.msg("server_time", "KG_MSG"))) : (a.signtime = void 0, a.showtime = (new Date).toLocaleString(), a.showtime += e.msg("local_time", "KG_MSG"));
                            m = b.getPassCheck(m, g, d.options.showSealsDlg);
                            void 0 === d.options.valid || null === d.options.valid || !1 === d.options.valid ? a.batchSignature ? b.sealService.verifyPwd({
                                    pwd: f,
                                    usercode: void 0 == a.usercode ? "" : a.usercode,
                                    keysn: b.keyData.keysn,
                                    successCall: function (e) {
                                        if (e.result) {
                                            for (e = 0; e < a.batchSignature.length && (a.batchSignature[e].signtime = a.signtime, a.batchSignature[e].showtime = a.showtime, a.batchSignature[e].position = a.position, a.batchSignature[e].autoCert = a.autoCert, a.batchSignature[e].okCall = a.okCall, a.batchSignature[e].cancelCall = a.cancelCall, a.batchSignature[e].beginCall =
                                            a.beginCall, a.batchSignature[e].endCall = a.endCall, a.batchSignature[e].protectedItems = a.protectedItems, a.batchSignature[e].datetime = a.datetime, a.batchSignature[e].offsetX = a.offsetX, a.batchSignature[e].offsetY = a.offsetY, a.batchSignature[e].changeOffsetXY = a.changeOffsetXY, a.batchSignature[e].isBatchSignature = !0, b.exec(a.batchSignature[e], function (c) {
                                                c.result ? void 0 !== d.options.showNoPW || !0 === d.options.showNoPW ? void 0 !== a.beginCancalCall && a.beginCancalCall && a.beginCancalCall.call(b) : (void 0 === d.options.showSealsDlg || !0 === d.options.showSealsDlg || b.autoDlg) && b.trigger("execSuccess", g, f, m) : b.errorCallback(c, a.errorCall)
                                            }, c, f, !0, a), void 0 !== a.batchSignature[e].endCall && a.batchSignature[e].endCall && a.batchSignature[e].endCall.call(b), "client" != d.options.sealType || !a.autoCert); ++e);
                                            void 0 !== a.beginCancalCall && a.beginCancalCall && a.beginCancalCall.call(b);
                                            (void 0 === d.options.showSealsDlg || !0 === d.options.showSealsDlg || b.autoDlg) && g.remove()
                                        } else b.errorCallback(e, a.errorCall)
                                    }
                                }) : (b.exec(a, function (c) {
                                    c.result ? (void 0 !== d.options.showNoPW || !0 === d.options.showNoPW ? void 0 !== a.beginCancalCall && a.beginCancalCall && a.beginCancalCall.call(b) : (void 0 === d.options.showSealsDlg || !0 === d.options.showSealsDlg || b.autoDlg) && b.trigger("execSuccess", g, f, m), g.remove()) : b.errorCallback(c, a.errorCall)
                                }, c, f), void 0 !== a.endCall && a.endCall && a.endCall.call(b)) : void 0 !== b.curDate && null !== b.curDate && b.sealExpired(c, a, b.curDate, function (e) {
                                    e ? a.batchSignature ? b.sealService.verifyPwd({
                                        pwd: f,
                                        keysn: b.keyData.keysn,
                                        successCall: function (e) {
                                            if (e.result) {
                                                for (e =
                                                0; e < a.batchSignature.length; ++e) a.batchSignature[e].signtime = a.signtime,
                                                a.batchSignature[e].showtime = a.showtime,
                                                a.batchSignature[e].position = a.position,
                                                a.batchSignature[e].autoCert = a.autoCert,
                                                a.batchSignature[e].okCall = a.okCall,
                                                a.batchSignature[e].cancelCall = a.cancelCall,
                                                a.batchSignature[e].beginCall = a.beginCall,
                                                a.batchSignature[e].endCall = a.endCall,
                                                a.batchSignature[e].protectedItems = a.protectedItems,
                                                a.batchSignature[e].datetime = a.datetime,
                                                a.batchSignature[e].offsetX = a.offsetX,
                                                a.batchSignature[e].offsetY =
                                                a.offsetY,
                                                a.batchSignature[e].changeOffsetXY = a.changeOffsetXY,
                                                a.batchSignature[e].isBatchSignature = !0,
                                                b.exec(a.batchSignature[e], function (c) {
                                                    c.result ? void 0 !== d.options.showNoPW || !0 === d.options.showNoPW ? void 0 !== a.beginCancalCall && a.beginCancalCall && a.beginCancalCall.call(b) : (void 0 === d.options.showSealsDlg || !0 === d.options.showSealsDlg || b.autoDlg) && b.trigger("execSuccess", g, f, m) : b.errorCallback(c, a.errorCall)
                                                }, c, f, !0),
                                                void 0 !== a.batchSignature[e].endCall && a.batchSignature[e].endCall && a.batchSignature[e].endCall.call(b);
                                                void 0 !== a.beginCancalCall && a.beginCancalCall && a.beginCancalCall.call(b);
                                                (void 0 === d.options.showSealsDlg || !0 === d.options.showSealsDlg || b.autoDlg) && g.remove()
                                            } else b.errorCallback(e, a.errorCall)
                                        }
                                    }) : (b.exec(a, function (c) {
                                        c.result ? (void 0 !== d.options.showNoPW || !0 === d.options.showNoPW ? void 0 !== a.beginCancalCall && a.beginCancalCall && a.beginCancalCall.call(b) : (void 0 === d.options.showSealsDlg || !0 === d.options.showSealsDlg || b.autoDlg) && b.trigger("execSuccess", g, f, m), g.remove()) : b.errorCallback(c, a.errorCall)
                                    }, c, f), void 0 !== a.endCall && a.endCall && a.endCall.call(b)) : b.errorCallback({
                                        errcode: "11103"
                                    }, a.errorCall)
                                }, k)
                        }
                    };
                if (void 0 !== d.options.showSealsDlg) {
                        var f = !0;
                        if ("auto" == d.options.showSealsDlg) {
                            var k = b.keyData;
                            k.seals && 1 == k.seals.length && (f = !1)
                        }
                        b.autoDlg = f;
                        if (!1 !== d.options.showSealsDlg && f) this.showSealsDialog(c);
                        else if (void 0 === d.options.password && void 0 !== b.password && (d.options.password = b.password), void 0 === d.options.password) b.errorCallback({
                            errcode: "11108"
                        }, a.errorCall);
                        else if (void 0 != d.options.timestamp && 1 == d.options.timestamp) if ("client" == d.options.sealType) {
                            var l = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                            l.invoke("KGGetTSURLInfo").ret(function (f) {
                                f.result ? l.invoke("KGGetTSWithDigest", f.TimeStampUrl, f.TimeStampUserName, f.TimeStampPassword, b.getSignTimeStamp(b.getProtectedData(a.protectedItems)), "").ret(function (f) {
                                    f.result ? c._onOk.call(b, b.keyData.seals[0], d.options.password, 0, f.TimeStr, f) : (b.errorCallback(f, a.errorCall, "KGGetTSWithDigest"), c._onOk.call(b, k.seals[0], pwdVal, 0))
                                }) : (b.errorCallback(f, a.errorCall, "KGGetTSURLInfo"), c._onOk.call(b, k.seals[0], pwdVal, 0))
                            })
                        } else m.ajax({
                            url: d.options.serverUrl + "/key/getTimeStamp",
                            data: {
                                keysn: b.keyData.keysn
                            },
                            async: !1,
                            success: function (a) {
                                a.result ? c._onOk.call(b, b.keyData.seals[0], d.options.password, 0, a.timestamp) : c._onOk.call(b, b.keyData.seals[0], d.options.password, 0)
                            },
                            error: function (a) {
                                c._onOk.call(b, b.keyData.seals[0], d.options.password, 0)
                            }
                        });
                        else c._onOk.call(b, b.keyData.seals[0], d.options.password, 0)
                    } else this.showSealsDialog(c)
            },
            showSealsDialog: function (a) {
                var b = this,
                    c = b.keyData;
                null != b.signdate && (c.signDateIsCheck = b.signdate.ischeck);
                var f = [c],
                    k = a._onOk,
                    l = a.beginCancalCall,
                    h = {
                        onCancel: a.cancelCall,
                        onShow: function () {
                            var a = this,
                                c = a.find(".kg-switcher");
                            if (c.length) {
                                    var f = new g.Switcher(c[0], b.switcher || {});
                                    m(".arrow-right").click(function (a) {
                                        a.preventDefault();
                                        f.swipeNext()
                                    });
                                    m(".arrow-left").click(function (a) {
                                        a.preventDefault();
                                        f.swipePrev()
                                    });
                                    m(".kg-guide span").click(function (a) {
                                        a.preventDefault();
                                        f.to(+this.getAttribute("index"))
                                    });
                                    b.switcher = f
                                }
                            a.find("#kg-dateSet").click(function (c) {
                                    b.showFontDialog(a)
                                });
                            setTimeout(function () {
                                    a.find("#kg-password").focus()
                                }, 40);
                            b.trigger("showSealsDialog", a);
                            d.options.showNoPW || b.trigger("showSealsDialog_PW", a);
                            a.find("#kg-password").keydown(function (b) {
                                    13 == b.keyCode && a.options.onOk.call(a)
                                })
                        },
                        onOk: function () {
                            var f = this,
                                l = f.find("#kg-password"),
                                h = l.val() || d.options.password;
                            if (!d.options.phoneshield && !h) return u.alert(e.msg("in_pwd_msg", "KG_MSG"), function () {
                                    setTimeout(function () {
                                        l.focus()
                                    }, 100)
                                }),
                            !1;
                            var g = f.find(".kg-wrapper .active");
                            f.isCheck = f.find("#kg-addDate").is(":checked");
                            var p = f.find("#kg-remenberPwd").is(":checked");
                            if ("client" == d.options.sealType && b.keyData.seals[g.attr("index")].SealTag && "GM" == b.keyData.seals[g.attr("index")].SealTag) {
                                    var n = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                                    n.invoke("KGValidate_GM", "", b.keyData.seals[g.attr("index")].SealCert, b.keyData.seals[g.attr("index")].ValidStart, b.keyData.seals[g.attr("index")].ValidEnd, b.keyData.seals[g.attr("index")].CertList, "").ret(function (l) {
                                        if (l.result) if (void 0 != d.options.timestamp && 1 == d.options.timestamp) {
                                            var m = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                                            m.invoke("KGGetTSURLInfo").ret(function (d) {
                                                d.result ? m.invoke("KGGetTSWithDigest", d.TimeStampUrl, d.TimeStampUserName, d.TimeStampPassword, b.getSignTimeStamp(b.getProtectedData(a.protectedItems)), "").ret(function (d) {
                                                    d.result ? k.call(f, c.seals[g.attr("index")], h, g.attr("index"), d.TimeStr, d, p ? !0 : !1) : (b.errorCallback(d, a.errorCall, "KGGetTSWithDigest"), k.call(f, c.seals[g.attr("index")], h, g.attr("index"), void 0, void 0, p ? !0 : !1))
                                                }) : (b.errorCallback(d, a.errorCall, "KGGetTSWithDigest"), k.call(f, c.seals[g.attr("index")], h, g.attr("index"), void 0, void 0, p ? !0 : !1))
                                            })
                                        } else k.call(f, c.seals[g.attr("index")], h, g.attr("index"), void 0, void 0, p ? !0 : !1);
                                        else return b.errorCallback(l, a.errorCall, "KGValidate_GM"),
                                        !1
                                    })
                                } else if ("client" == d.options.sealType && b.keyData.seals[g.attr("index")].sealtag && "GB" == b.keyData.seals[g.attr("index")].sealtag) {
                                    var n = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319"),
                                        q = b.keyData.seals[g.attr("index")];
                                    n.invoke("KGVerifyGBSealAction", q.sesealinfo, q.signsn).ret(function (c) {
                                            if (c.result) k.call(f, q, h, g.attr("index"), void 0, void 0, p ? !0 : !1);
                                            else return b.errorCallback(c, a.errorCall, "KGVerifyGBSealAction"),
                                            !1
                                        })
                                } else return g = f.find(".kg-wrapper .active"),
                            f.isCheck = f.find("#kg-addDate").is(":checked"),
                            void 0 != d.options.timestamp && 1 == d.options.timestamp ? "client" == d.options.sealType ? (n = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319"), n.invoke("KGGetTSURLInfo").ret(function (d) {
                                    d.result ? n.invoke("KGGetTSWithDigest", d.TimeStampUrl, d.TimeStampUserName, d.TimeStampPassword, b.getSignTimeStamp(b.getProtectedData(a.protectedItems)), "").ret(function (d) {
                                        d.result ? k.call(f, c.seals[g.attr("index")], h, g.attr("index"), d.TimeStr, d) : (b.errorCallback(d, a.errorCall, "KGGetTSWithDigest"), k.call(f, c.seals[g.attr("index")], h, g.attr("index")))
                                    }) : (b.errorCallback(d, a.errorCall, "KGGetTSURLInfo"), k.call(f, c.seals[g.attr("index")], h, g.attr("index")))
                                })) : m.ajax({
                                    url: d.options.serverUrl + "/key/getTimeStamp",
                                    data: {
                                        keysn: b.keyData.keysn
                                    },
                                    async: !1,
                                    success: function (a) {
                                        a.result ? k.call(f, c.seals[g.attr("index")], h, g.attr("index"), a.timestamp) : k.call(f, c.seals[g.attr("index")], h, g.attr("index"))
                                    },
                                    error: function (a) {
                                        k.call(f, c.seals[g.attr("index")], h, g.attr("index"))
                                    }
                                }) : k.call(f, c.seals[g.attr("index")], h, g.attr("index")),
                            !1
                        },
                        content: function () {
                            f.push(b.toBase64Img);
                            var a = [d.options.template.showSealsBtl].concat(f);
                            d.options.showNoPW && (a = [d.options.template.showSealsBtl_nopassword].concat(f));
                            return g.template.apply(null, a)
                        }
                    };
                void 0 !== l && l && (h = g.extend({
                        onCancel: function () {
                            void 0 !== l && l && l.call(b);
                            this.close()
                        }
                    }, h));
                d.options.showNoPW ? b.showDialog("showSealsBtl_nopassword", h) : b.showDialog("showSealsBtl", h)
            },
            showFontDialog: function (a) {
                var b = this,
                    c = u.dafaultDate,
                    f = null == b.signdate ? {} : b.signdate,
                    k = u.defaultFont,
                    b = this,
                    b = null == f.fontFormat ? k.fontFormat : f.fontFormat,
                    l = null == f.fontFamily ? k.fontFamily : f.fontFamily,
                    h = null == f.fontSize ? k.fontSize : f.fontSize,
                    n = k.fontColor;
                null != f.fontColor && /^#([0-9a-fA-f]{6})$/.test(f.fontColor) && (n = f.fontColor.toUpperCase());
                f = null == f.position ? k.position : f.position;
                null != a.fontSel && (b = a.fontSel.fontFormat, l = a.fontSel.fontFamily, h = a.fontSel.fontSize, n = a.fontSel.fontColor, f = u.fontTemplate.position[a.fontSel.fontPositionIndex]);
                var q = this.getArrayPush(d.options.fontTemplate.fontFormat, b),
                    t = [{
                        fontFormat: this.getFormatDate(q, c),
                        fontFamily: this.getArrayPush(d.options.fontTemplate.fontFamily, l),
                        fontSize: this.getArrayPush(d.options.fontTemplate.fontSize, h),
                        fontColor: this.getArrayPush(d.options.fontTemplate.fontColor, n),
                        fontPosition: d.options.fontTemplate.position,
                        dFontFormat: e.Utils.formatDate(new Date(c), b),
                        dFontFamily: l,
                        dFontSize: h,
                        dFontColor: n,
                        dFontPosition: f
                    }],
                    c = {
                        title: e.msg("DateSet", "KG_TITLE"),
                        content: function () {
                            var a = [d.options.template.dateSetBtl].concat(t);
                            return g.template.apply(null, a)
                        },
                        onOk: function () {
                            var b = this.find("#kg-fontFormat").get(0).selectedIndex;
                            a.fontSel = {
                                fontFormat: q[b],
                                fontFamily: this.find("#kg-fontFamily").val(),
                                fontSize: this.find("#kg-fontSize").val(),
                                fontColor: e.Utils.colorHex(this.find("#kg-select-color").css("backgroundColor")),
                                fontPositionIndex: this.find("#kg-fontPosition").get(0).selectedIndex
                            }
                        }
                    },
                    r = u.showDialog("dateSetBtl", c);
                r.find("#kg-select-color").on("click", function () {
                        r.find(".kg-color-div").css("display", "block");
                        r.find("#kg-color-ul").css("display", "block")
                    });
                r.find("#kg-color-ul li a").click(function () {
                        m("#kg-select-color").css("backgroundColor", m(this).css("backgroundColor"));
                        r.find(".kg-color-div").css("display", "none");
                        r.find("#kg-color-ul").css("display", "none")
                    });
                r.find(".kg-color-div").on("mouseover", function (a) {
                        this.contains(a.fromElement || a.relatedTarget) || m(this).show()
                    });
                r.find(".kg-color-div").on("mouseout", function (a) {
                        this.contains(a.toElement || a.relatedTarget) || m(this).hide()
                    });
                return r
            },
            getArrayPush: function (a, b) {
                -1 == jQuery.inArray(b, a) && a.push(b);
                return a
            },
            getFormatDate: function (a, b) {
                for (var c = [], d = 0; d < a.length; d++) c[d] = e.Utils.formatDate(new Date(b), a[d]);
                return c
            },
            genId: function () {
                var a = (new Date).getTime(),
                    b = "" + Math.ceil((9301 * (new Date).getTime() + 49297) % 233280 / 233280 * 99999),
                    c = 5 - b.length;
                if (0 < c) for (var d = 0; d < c; d++) b = "0" + b;
                return a + b
            },
            getSeal: function (a) {
                return this.keyData.seals[a]
            },
            saveSignature: function (a, b, c, f) {
                var k = this;
                void 0 != a && void 0 != b && void 0 != c && (a = void 0 != d.options.cache_path && null != d.options.cache_path ? {
                    documentId: a,
                    signatureId: b,
                    signaturedata: c,
                    cachepath: d.options.cache_path
                } : {
                    documentId: a,
                    signatureId: b,
                    signaturedata: c,
                    cachepath: ""
                }, e.surry(d.options.serverUrl).request("/signature/saveHtmlSignature", a).ret(function (a) {
                    void 0 !== f && null !== f && f.call(k, a)
                }))
            },
            removeSignature: function (a, b, c) {
                var f = this;
                void 0 != a && void 0 != b && (a = {
                    documentId: a,
                    signatureId: b
                }, e.surry(d.options.serverUrl).request("/signature/reomveHtmlSignature", a).ret(function (a) {
                    void 0 !== c && null !== c && c.call(f, a)
                }))
            },
            getSaveSignatures: function (a, b) {
                void 0 != a && e.surry(d.options.serverUrl).request("/signature/getHtmlSignature", {
                    documentId: a
                }).ret(function (a) {
                    a.result && b(a.sign)
                })
            }
        });
    m.extend(d.options, {
            certType: "client",
            sealType: "client",
            clientUrl: "http://127.0.0.1:9581",
            moveable: !0,
            signable: !0,
            fontTemplate: u.fontTemplate,
            template: {
                showSealsBtl: u.template.sealTpl,
                showSealsBtl_nopassword: u.template.sealTpl_nopassword,
                signSignatureBtl: '<div id="kg-dialog-sign" class="kg-dialog kg-dialog-password kg-dialog-sign"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div> </div></div></div>',
                revokeSignatureBtl: '<div id="kg-verifyPass" class="kg-dialog  kg-dialog-password"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u7b7e\u7ae0\uff1a</label><div class="kg-sm kg-sm-7"><p class="kg-form-static"><%this.signatureData.seal.signname%></p></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-3 kg-label">\u5bc6\u7801\uff1a</label><div class="kg-sm kg-sm-7"> <input type="password" name="kgpassword" autocomplete="new-password" id="kg-password" class="form-control"></div> </div></div></div>',
                dateSetBtl: '<div id="kg-setDate" class="kg-dialog kg-dialog-Date"><div class="kg-form"><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u683c\u5f0f\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFormat" id="kg-fontFormat" class="kg-select kg-fontFormat"><% var fontFormat = this.fontFormat; %><% for(var i=0;i<fontFormat.length;i++) {%><% if(fontFormat[i] == this.dFontFormat){%><option class="kg-option" value="<% fontFormat[i]%>" selected><% fontFormat[i]%></option><%}else{%><option class="kg-option" value="<% fontFormat[i]%>"><% fontFormat[i]%></option><%}%><%}%></select></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u5b57\u4f53\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontFamily" id="kg-fontFamily" class="kg-select kg-fontFamily"><% var fontFamily = this.fontFamily; %><% for(var i=0;i<fontFamily.length;i++) {%><% if(fontFamily[i] == this.dFontFamily){%><option class="kg-option" value="<% fontFamily[i]%>" selected><% fontFamily[i]%></option><%}else{%><option class="kg-option" value="<% fontFamily[i]%>"><% fontFamily[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u5c3a\u5bf8\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontSize" id="kg-fontSize" class="kg-select kg-fontSize"><% var fontSize = this.fontSize; %><% for(var i=0;i<fontSize.length;i++) {%><% if(fontSize[i] == this.dFontSize){%><option class="kg-option" value="<% fontSize[i]%>" selected><% fontSize[i]%></option><%}else{%><option class="kg-option" value="<% fontSize[i]%>"><% fontSize[i]%></option><%}%><%}%></select></div> </div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u989c\u8272\uff1a</label><div class="kg-sm kg-sm-6"><% var fontColor = this.fontColor; %><div id="kg-select-color" class="kg-select-color" style="background-color:<% this.dFontColor%>"/><div class="kg-color-div"><ul class="kg-color-ul" id="kg-color-ul"><% for(var i=0;i<fontColor.length;i++){ %><li class="kg-color-li"><a href="javascript:;" style="background-color:<% fontColor[i]%>"></a></li><%}%></ul></div></div></div><div class="form-item clearfix"><label class="kg-sm kg-sm-4 kg-label">\u4f4d\u7f6e\uff1a</label><div class="kg-sm kg-sm-6"><select name="fontPosition" id="kg-fontPosition" class="kg-select kg-fontPosition"><% var fontPosition = this.fontPosition; %><% for(var i=0;i<fontPosition.length;i++) {%><% if(fontPosition[i] == this.dFontPosition){%><option class="kg-option" value="<% fontPosition[i]%>" selected><% fontPosition[i]%></option><%}else{%><option class="kg-option" value="<% fontPosition[i]%>"><% fontPosition[i]%></option><%}%><%}%></select></div> </div></div></div>'
            }
        });
    d.list = {};
    d.updateList = [];
    d.removeList = [];
    d.loadSignature = function (a, b, c, f) {
            var e = {};
            void 0 == d.options.extra && (d.options.extra = {});
            e[a] = b;
            void 0 !== e.extra && null !== e.extra && (d.options.extra[e.signatureid] = e.extra);
            r(e, c ||
            function (a) {
                a.verify()
            }, f)
        };
    d.loadSignatures = function (a, b, c) {
            var f = {};
            void 0 == d.options.extra && (d.options.extra = {});
            if (g.is("Array", a)) for (var e = 0; e < a.length; e++) {
                var l = a[e];
                f[l.signatureid] = l.signatureData;
                void 0 !== l.extra && null !== l.extra && (d.options.extra[l.signatureid] = l.extra)
            } else for (e in a) f[e] = a[e];
            r(f, b ||
            function (a) {
                d.verify()
            }, c)
        };
    d.resetSignaturePos = function (a) {
            void 0 == d.options.extra && (d.options.extra = {});
            if (g.is("Array", a)) for (var b = 0; b < a.length; b++) {
                var c = a[b];
                void 0 !== c.extra && null !== c.extra && (d.options.extra[c.signatureid] = c.extra)
            } else for (b in a) d.options.extra[b] = a[b]
        };
    d.clearRPW = function () {
            delCookie("ksn");
            delCookie("pwd");
            delCookie("ck")
        };
    var z = new h("Signature");
    d.addLiseter = function (a, b) {
            z.on(a, b)
        };
    d.verify = function () {
            var a = d.list,
                b = [];
            z.trigger("beforeVerify", f);
            for (var c in a) {
                    var f =
                    a[c];
                    f._verify(null, {
                        batchVerify: !0
                    }) || b.push(f);
                    z.trigger("eachVerify", f)
                }
            z.trigger("verify", f);
            return b
        };
    d.verifySignByList = function (a) {
            var b = [];
            z.trigger("beforeVerify", d);
            for (var c in a) {
                var d = a[c],
                    e = d._verify(null, {
                        batchVerify: !0
                    }),
                    l = d.signatureData,
                    g = {};
                g.appname = l.appname;
                g.documentid = l.documentid;
                g.documentname = l.documentname;
                g.keysn = l.keysn;
                g.orgname = l.orgname;
                g.timestamp = l.timestamp;
                g.usercode = l.usercode;
                g.username = l.username;
                g.signname = l.seal.signname;
                g.signsn = l.seal.signsn;
                e || (g.modifiedItems =
                    d.modifiedItems);
                b.push(g);
                z.trigger("eachVerify", d)
            }
            z.trigger("verify", d);
            return b
        };
    d.bind = function (a) {
            g.extend(d.asyn, a)
        };
    d.show = function () {
            var a = d.list,
                b;
            for (b in a) a[b].show()
        };
    d.hide = function () {
            var a = d.list,
                b;
            for (b in a) a[b].hide()
        };
    d.AXI = function (a, b, c) {
            d.authcode = l;
            var f = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319"),
                k;
            for (k in b) {
                    var l = b[k];
                    "" !== k && "" !== l ? f.invoke(a, k, l) : null !== k && "" !== k ? f.invoke(a, k) : f.invoke(a)
                }
            f.invoke("KGPhoneShieldLic").ret(function (a) {
                    d.options.phoneshield = "1" == a.phoneshield ? !0 : !1;
                    d.options.phoneshield && (e.options.timeout = 7E4)
                });
            f.ret(function (a) {
                    a.result && (d.options.moveable_self ? f.invoke("KGGetKeyOtherInfo", "0").ret(function (b) {
                        b.result && (b = b.Res.substring(1, b.Res.length - 1), d.options.keysn = b);
                        void 0 !== c && null !== c && c(a)
                    }) : void 0 !== c && null !== c && c(a))
                });
            return f
        };
    d.showAndHideBySignatureId = function (a, b) {
            var c = d.list,
                f;
            for (f in c) 0 <= f.indexOf(a) && (b ? c[f].show() : c[f].hide())
        };
    d.addIcon = function (a) {
            var b = d.options.icons || [];
            b.push(a);
            d.options.icons = b
        };
    d.create = function (a) {
            var b = m.extend({}, d.options, a);
            void 0 !== a && void 0 !== a.imgtag && (d.options.imgtag = a.imgtag);
            return new d._create(b)
        };
    m.extend(d.prototype, {
            saveSignatures: function () {},
            getSignatures: function () {}
        });
    h = function (a) {
            var b = this;
            m.each(a, function (a, d) {
                if ("function" === typeof b[a]) b[a](d);
                else b[a] = d
            })
        };
    g.inherit(h, d.SealService);
    v = function (a) {
            var b = this;
            m.each(a, function (a, d) {
                if ("function" === typeof b[a]) b[a](d);
                else b[a] = d
            })
        };
    g.inherit(v, d.CertService);
    m.extend(h.prototype, {
            saveLog: function (a) {
                var b = [];
                g.is("Object", a) ? b.push(a) : b = a;
                a = n({
                    MSG: b
                });
                e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319").invoke("SetParamByName", "SAVEMSG", a)
            },
            loadSeal: function (a) {
                var b = this,
                    c = a.successCall,
                    f = a.errorCall,
                    k = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                b.appcode ? k.invoke("SetParamByName", "APPCODE", b.appcode) : b.appcode = "";
                k.invoke("KGGetKeyInfo").ret(function (e) {
                        if (e.result) {
                            if ("" == e.seals) if (null != a.data) e.seals = {},
                            e.seals[0] = {
                                signname: "",
                                width: "",
                                signsn: null,
                                height: "",
                                imgdata: "",
                                imgext: ".png"
                            };
                            else {
                                f.call(b, {
                                    result: !1,
                                    errcode: "11"
                                });
                                return
                            } else if (void 0 !== d.options.imgtag && null !== d.options.imgtag && 0 !== d.options.imgtag) {
                                var k = [],
                                    g;
                                for (g in e.seals) {
                                        var l = e.seals[g];
                                        void 0 !== l && parseInt(l.imgtag) == d.options.imgtag && (k[k.length] = e.seals[g])
                                    }
                                e.seals = k
                            }
                            c.call(b, e)
                        } else f.call(b, e)
                    })
            },
            verifyPwd: function (a) {
                var b = this,
                    c = a.pwd,
                    f = a.successCall,
                    k = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                null == c && (c = "");
                k.invoke("KGVerifyPin", c, a.keysn).ret(function (a) {
                        f.call(b, a)
                    })
            },
            getKeysn: function (a, b) {
                e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319").invoke("KGGetKeyOtherInfo", "0").ret(function (a) {
                    a.result ? (a = a.Res.substring(1, a.Res.length - 1), b(a)) : u.alert(e.msg(a))
                })
            }
        });
    m.extend(v.prototype, {
            verifySign: function (a) {
                var b = this,
                    c = a.successCall,
                    f = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                a.seal && a.seal.sealtag && "GB" == a.seal.sealtag && f.invoke("SetParamByName", "GBSIGNSN", a.seal.signsn);
                f.invoke("KGVerifySignMessage", "123456", a.signdata, a.signeddata).ret(function (d) {
                        var e;
                        e = d.result || "-8" !== d.errcode ? d : {
                            result: !1
                        };
                        e.result && a.seal && "GB" == a.seal.sealtag ? f.invoke("KGVerifyGBStampAction", a.signeddata).ret(function (a) {
                            a.result || (e = {
                                result: !1
                            });
                            c.call(b, e)
                        }) : c.call(b, e)
                    });
                a.seal && a.seal.sealtag && "GB" == a.seal.sealtag && f.invoke("SetParamByName", "GBSIGNSN", "")
            },
            parseDate: function (a) {
                var b = new Date;
                b.setFullYear(a.substring(0, 4), +a.substring(4, 6) - 1, a.substring(6, 8));
                b.setHours(a.substring(8, 10), a.substring(10, 12), a.substring(12, 14), 0);
                return b.getTime()
            },
            sign: function (a) {
                for (var b = this, c = a.successCall, f = a.signMeta, g = [], l = [], h = a.seal, n = 0; n < f.length; n++) {
                    var q = f[n];
                    g.push(q.signdata);
                    l.push("" + q.signdata.length)
                }
                f = e.surry(d.options.clientUrl, "IWEBASSIST.iWebAssistCtrl.1", "4240FB41-A213-42B6-8CB5E6705C99B319");
                h && h.sealtag && "GB" == h.sealtag && (n = h.sesealinfo, f.invoke("SetParamByName", "CLEARGBSESEALINFO", ""), f.invoke("SetParamByName", "GBSESEALINFO", n), f.invoke("SetParamByName", "GBSIGNSN", h.signsn));
                a = a.password;
                null == a && (a = "");
                f.invoke("KGCrySignMessage", a, g.join(";"), +l[0]).ret(function (a) {
                    a = m.extend({}, a);
                    a.result && (a.certinfo.notAfter = b.parseDate(a.certinfo.notAfter), a.certinfo.notBefore = b.parseDate(a.certinfo.notBefore));
                    c.call(b, a)
                });
                h && h.sealtag && "GB" == h.sealtag && (f.invoke("SetParamByName", "CLEARGBSESEALINFO", ""), f.invoke("SetParamByName", "GBSIGNSN", ""))
            }
        });
    d.addProvider("cert", "client", v);
    d.addProvider("seal", "client", h);
    h = function (a, b) {
            var c = this;
            c.sData = b;
            m.each(a, function (a, b) {
                if ("function" === typeof c[a]) c[a](b);
                else c[a] = b
            })
        };
    g.inherit(h, d.SealService);
    var J = function (a, b) {
            var c = this;
            c.sData = b;
            m.each(a, function (a, b) {
                if ("function" === typeof c[a]) c[a](b);
                else c[a] = b
            })
        };
    g.inherit(J, d.CertService);
    m.extend(h.prototype, {
            getSealsUrl: "/key/load",
            verifyPwdUrl: "/key/verify",
            saveLogUrl: "/signature/saveLog",
            saveLog: function (a) {
                a = n(a);
                e.surry(this.serverUrl).request(this.saveLogUrl, {
                    loginfo: a
                }).ret(function (a) {
                    a.result || d.prototype.error.call(null, a)
                })
            },
            getPwdSaveTime: function (a, b) {
                e.surry(d.options.serverUrl).request("/signature/getPwdSaveTime").ret(function (c) {
                    a(c.result ? c.pwdTime : b)
                })
            },
            loadSeal: function (a) {
                var b = this,
                    c = a.successCall,
                    f = a.errorCall,
                    g = {
                        usercode: b.usercode,
                        keysn: b.keysn,
                        signname: b.signname,
                        authcode: b.authcode,
                        password: d.options.password,
                        sealTag: d.options.sealTag
                    };
                e.surry(b.serverUrl).request(b.getSealsUrl, g).ret(function (e) {
                        if (e.result) {
                            if ("" == e.seals) if (null != a.data) e.seals = {},
                            e.seals[0] = {
                                signname: "",
                                width: "",
                                signsn: null,
                                height: "",
                                imgdata: "",
                                imgext: ".png"
                            };
                            else {
                                f.call(b, {
                                    result: !1,
                                    errcode: "11101"
                                });
                                return
                            } else if (void 0 !== d.options.imgtag && null !== d.options.imgtag && 0 !== d.options.imgtag) {
                                var g = [],
                                    k;
                                for (k in e.seals) {
                                        var h = e.seals[k];
                                        void 0 !== h && parseInt(h.imgtag) == d.options.imgtag && (g[g.length] = e.seals[k])
                                    }
                                e.seals = g
                            }
                            c.call(b, e)
                        } else f.call(b, e)
                    })
            },
            verifyPwd: function (a) {
                var b = this,
                    c = a.successCall;
                a = {
                        usercode: void 0 == b.sData ? a.usercode : b.sData.usercode,
                        keysn: void 0 == b.sData ? a.keysn : b.sData.keysn,
                        password: a.pwd
                    };
                e.surry(b.serverUrl).request(b.verifyPwdUrl, a).ret(function (a) {
                        c.call(b, a)
                    })
            }
        });
    m.extend(J.prototype, {
            signUrl: "/sign",
            verifySignUrl: "/sign/verify",
            verifySign: function (a) {
                var b = this,
                    c = b.sData,
                    d = a.successCall;
                e.surry(b.serverUrl).request(b.verifySignUrl, {
                        certType: c.certType,
                        isUTF8: c.isUTF8,
                        signsn: c.seal.signsn,
                        html2sign: c.signMeta.html2sign,
                        keysn: c.keysn,
                        signsn: c.seal.signsn,
                        signdata: a.signdata,
                        signeddata: c.signMeta.signeddata,
                        crtdata: c.signMeta.certinfo.crtdata,
                        sealTag: b.sealTag
                    }).ret(function (a) {
                        d.call(b, a)
                    })
            },
            sign: function (a) {
                for (var b = this, c = a.signMeta, d = a.successCall, g = [], h = 0; h < c.length; h++) {
                    var m = c[h];
                    "GM" == b.sealTag && (m.hashAlg = "sm3", m.encryptAlg = "SM2");
                    g.push("$" + (m.hashAlg || b.hashAlg) + "|" + (m.encryptAlg || b.encryptAlg) + "$" + m.signdata)
                }
                a = {
                    keysn: a.keysn,
                    password: a.password,
                    signdata: g.join(";"),
                    signsn: a.signsn,
                    sealTag: b.sealTag
                };
                e.surry(b.serverUrl).request(b.signUrl, a).ret(function (a) {
                    a.result && (a.certinfo.algName = a.certinfo.algName.replace("with", ""));
                    d.call(b, a)
                })
            }
        });
    d.addProvider("cert", "server", J);
    d.addProvider("seal", "server", h);
    d.alert = u.alert;
    var Q = d.version = {
            name: "1.0.20",
            code: 100
        };
    return q.Signature = d
});
// V1.0.0.348    
//# sourceMappingURL=c:/signature.min.map